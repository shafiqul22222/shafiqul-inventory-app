<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∂‡¶´‡¶ø‡¶ï‡ßÅ‡¶≤ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ï‡¶∞‡ßç‡¶®‡¶æ‡¶∞ - ‡¶á‡¶®‡¶≠‡ßá‡¶®‡ßç‡¶ü‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü (Firebase)</title>
    
    <!-- Firebase SDK (Software Development Kit) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

    <!-- Chart.js ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- CSS ‡¶ï‡ßã‡¶° --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        :root {
            --primary-color: #3498db; --secondary-color: #2980b9; --dark-color: #2c3e50; --light-color: #ecf0f1;
            --white-color: #fff; --text-color: #34495e; --border-color: #dce4e8; --danger-color: #e74c3c;
            --warning-color: #f39c12; --info-color: #1abc9c; --success-color: #2ecc71;
            --card-color-1: linear-gradient(135deg, #007bff, #3498db); --card-color-2: linear-gradient(135deg, #2ecc71, #28a745);
            --card-color-3: linear-gradient(135deg, #1abc9c, #16a085); --card-color-4: linear-gradient(135deg, #9b59b6, #8e44ad);
            --card-color-5: linear-gradient(135deg, #f1c40f, #f39c12); --card-color-6: linear-gradient(135deg, #e74c3c, #c0392b);
            --card-color-7: linear-gradient(135deg, #e67e22, #d35400); --card-color-8: linear-gradient(135deg, #34495e, #2c3e50);
            --card-color-9: linear-gradient(135deg, #48c6ef, #6f86d6); /* New card color */
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--light-color); color: var(--text-color); line-height: 1.6; font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #login-page { display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #e0f2f1, #b2dfdb); }
        @keyframes slideDownFadeIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .login-container { background: var(--white-color); padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 420px; text-align: center; animation: slideDownFadeIn 0.7s ease-out; border-top: 5px solid var(--primary-color); }
        .login-container .shop-logo { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin: -85px auto 20px auto; display: block; border: 5px solid var(--white-color); box-shadow: 0 4px 10px rgba(0,0,0,0.1); background: #fff; }
        .login-container h2 { margin-bottom: 10px; color: var(--dark-color); font-size: 1.8rem; }
        .login-container p { margin-bottom: 25px; color: #777; }
        .input-group { position: relative; margin-bottom: 20px; }
        .input-group .input-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; }
        .login-container input { width: 100%; padding: 14px 14px 14px 45px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; transition: border-color 0.3s, box-shadow 0.3s; }
        .login-container input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        .login-btn { width: 100%; padding: 14px; background: var(--primary-color); color: var(--white-color); border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background 0.3s, transform 0.2s; }
        .login-btn:hover { background: var(--secondary-color); transform: translateY(-2px); }
        #login-error { color: var(--danger-color); margin-top: 15px; display: none; font-weight: bold; }
        #main-app { display: none; grid-template-columns: 260px 1fr; grid-template-rows: 65px 1fr; grid-template-areas: "nav header" "nav content"; height: 100vh; }
        .app-header { grid-area: header; background: var(--white-color); color: var(--text-color); display: flex; justify-content: space-between; align-items: center; padding: 0 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-bottom: 1px solid var(--border-color); z-index: 1001; }
        .header-left-section { display: flex; align-items: center; }
        .header-right-section { display: flex; align-items: center; gap: 20px; }
        .language-switcher select { padding: 8px; border-radius: 5px; border: 1px solid var(--border-color); background-color: #f9f9f9; cursor: pointer; font-weight: 500;}
        #header-logo { height: 45px; width: 45px; border-radius: 50%; margin-right: 15px; object-fit: cover; background: #fff; border: 2px solid var(--border-color); }
        .app-header .menu-toggle { display: none; font-size: 24px; cursor: pointer; color: var(--primary-color); }
        .app-header h1 { font-size: 1.5rem; font-weight: 600; }
        .app-header .logout-btn { background: var(--danger-color); color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; transition: background 0.3s; }
        .app-header .logout-btn:hover { background: #c0392b; }
        .app-nav { grid-area: nav; background: var(--dark-color); color: var(--white-color); transition: transform 0.3s ease-in-out; overflow-y: auto; display: flex; flex-direction: column; }
        
        /* --- ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶Ö‡¶Ç‡¶∂ ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ --- */
        .app-nav ul { list-style: none; flex-grow: 1; margin-top: 0; padding: 0; display: flex; flex-direction: column; }
        .app-nav ul li { display: flex; flex-grow: 1; }
        .app-nav ul li a { display: flex; align-items: center; color: #bdc3c7; padding: 16px 25px; text-decoration: none; transition: all 0.3s ease; border-left: 4px solid transparent; font-weight: 500; width: 100%; }
        /* --- ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶Ö‡¶Ç‡¶∂ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶á ‡¶∂‡ßá‡¶∑ --- */

        .app-nav ul li a:hover { background: #34495e; color: var(--white-color); }
        .app-nav ul li a.active { background: var(--primary-color); color: var(--white-color); border-left-color: var(--warning-color); font-weight: 600; }
        .app-nav ul li a .nav-text { }
        .app-nav ul li a span:first-child { font-size: 1.2em; width: 20px; text-align: center; margin-right: 15px;}
        .app-content { grid-area: content; padding: 30px; overflow-y: auto; }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .content-header { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); font-size: 1.8rem; font-weight: 600; color: var(--primary-color); }
        .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 25px; }
        .card { color: var(--white-color); padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); display: flex; align-items: center; justify-content: space-between; animation: slideInUp 0.5s ease-out; transition: transform 0.3s ease, box-shadow 0.3s ease; border: none; }
        .card:hover { transform: translateY(-6px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .card-icon { font-size: 3.5rem; opacity: 0.8; }
        .card-content { text-align: right; }
        .card-content h3 { margin-bottom: 5px; font-size: 1rem; font-weight: 400; text-transform: uppercase; letter-spacing: 0.5px;}
        .card-content p { font-size: 2rem; font-weight: 600; margin: 0; }
        .card.c1 { background: var(--card-color-1); } .card.c2 { background: var(--card-color-2); } .card.c3 { background: var(--card-color-3); } .card.c4 { background: var(--card-color-4); } .card.c5 { background: var(--card-color-5); } .card.c6 { background: var(--card-color-6); } .card.c7 { background: var(--card-color-7); } .card.c8 { background: var(--card-color-8); } .card.c9 { background: var(--card-color-9); }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .dashboard-filter-container { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .dashboard-filter-btn { padding: 8px 18px; border: 1px solid var(--border-color); background-color: var(--white-color); color: var(--text-color); border-radius: 20px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
        .dashboard-filter-btn:hover { background-color: var(--light-color); border-color: var(--primary-color); }
        .dashboard-filter-btn.active { background-color: var(--primary-color); color: var(--white-color); border-color: var(--primary-color); font-weight: 600; }

        .form-container, .table-container, #pos-cart-area { background: var(--white-color); padding: 25px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.06); }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 8px; font-weight: 500; font-size: 0.9rem; }
        .form-group input, .form-group select, .form-group textarea { padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #fdfdfd; transition: border-color 0.3s, box-shadow 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        .btn { padding: 12px 22px; border: none; border-radius: 8px; cursor: pointer; color: var(--white-color); font-weight: 600; transition: all 0.3s; }
        .btn-success { background: var(--success-color); } .btn-success:hover:not(:disabled) { background: #27ae60; }
        .btn:disabled { background-color: #bdc3c7; cursor: not-allowed; opacity: 0.8; }
        .btn-primary { background: var(--primary-color); } .btn-primary:hover:not(:disabled) { background: var(--secondary-color); transform: translateY(-2px); }
        .btn-warning { background: var(--warning-color); color: #fff;} .btn-warning:hover:not(:disabled) { background: #f1c40f; }
        .btn-info { background: var(--info-color); } .btn-info:hover:not(:disabled) { background: #16a085; }
        .table-container { width: 100%; overflow-x: auto; padding: 0;}
        table { width: 100%; border-collapse: collapse; margin-top: 0; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle;}
        th { background-color: #f8f9fa; color: var(--dark-color); text-transform: uppercase; font-size: 0.85rem; font-weight: 600; border-top: 1px solid var(--border-color);}
        tr:nth-child(even) { background-color: #fdfdfd; } /* Zebra striping for better readability */
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: rgba(52, 152, 219, 0.05); }
        .action-btn { padding: 6px 12px; margin-right: 5px; border: none; border-radius: 6px; cursor: pointer; color: white; font-size: 0.8rem;}
        .edit-btn { background-color: var(--warning-color); color: #fff;}
        .delete-btn { background-color: var(--danger-color); }
        .table-product-image { width: 50px; height: 50px; object-fit: cover; border-radius: 8px; border: 1px solid var(--border-color); }
        #logo-preview { width: 150px; height: 150px; border: 3px dashed var(--border-color); border-radius: 50%; margin: 20px auto; display: block; object-fit: cover; }
        #product-image-preview { max-width: 150px; max-height: 150px; border: 2px dashed var(--border-color); border-radius: 8px; margin: 0 auto 20px auto; display: block; object-fit: cover; }
        
        .pos-layout { display: grid; grid-template-columns: 1.5fr 2.5fr; gap: 25px; align-items: flex-start; }
        #pos-product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; max-height: 75vh; overflow-y: auto; background: var(--white-color); padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.06); }
        .pos-product-btn { background: #fff; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; display: flex; flex-direction: column; justify-content: space-between; }
        .pos-product-btn:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-color: var(--primary-color); }
        .pos-product-btn img { width: 100%; height: 90px; object-fit: cover; border-radius: 6px; margin-bottom: 8px; }
        .pos-product-btn h4 { margin: 5px 0; font-size: 14px; color: var(--text-color); flex-grow: 1; font-weight: 500; }
        .pos-product-btn p { margin: 0; font-size: 16px; font-weight: 600; color: var(--primary-color); }
        #pos-cart-table input[type="number"] { padding: 5px; text-align: center; }
        #pos-cart-table .delete-btn { padding: 5px 8px; }
        .pos-summary .form-group input { background: #f8f9fa; font-weight: bold; }

        @media (max-width: 768px) {
            #main-app { grid-template-columns: 1fr; grid-template-areas: "header" "content"; }
            .app-nav { position: fixed; left: 0; top: 0; width: 260px; height: 100vh; transform: translateX(-100%); z-index: 1000; box-shadow: 5px 0 20px rgba(0,0,0,0.1); }
            .app-nav.active { transform: translateX(0); }
            .app-header { z-index: 1001; position: relative; }
            .app-header .menu-toggle { display: block; margin-right: 15px; }
            .app-content { padding: 20px; }
            table thead { display: none; }
            table, table tbody, table tr, table td { display: block; width: 100%; }
            table tr { margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
            table td { text-align: right; padding-left: 50%; position: relative; border-bottom: 1px solid #eee; }
            table td:last-child { border-bottom: none; }
            table td::before { content: attr(data-label); position: absolute; left: 15px; width: calc(50% - 30px); text-align: left; font-weight: 600; color: var(--primary-color); }
            .table-product-image { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); }
            td[data-label="‡¶è‡¶ï‡¶∂‡¶®"] { display: flex; justify-content: flex-end; align-items: center; }
        }

        @media (max-width: 1200px) { .pos-layout { grid-template-columns: 1fr 1.5fr; } }
        @media (max-width: 992px) { .pos-layout { grid-template-columns: 1fr; } #pos-product-grid { max-height: 45vh; order: -1; } } /* Products first on small screens */
        
        @media print { body * { visibility: hidden; } .print-area, .print-area * { visibility: visible; } .print-area { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; box-shadow: none; border: none; } .no-print { display: none; } }
    </style>
</head>
<body>
    
    <div id="login-page">
        <div class="login-container">
            <img src="https://via.placeholder.com/150" alt="Shop Logo" class="shop-logo" id="login-page-logo">
            <h2 data-lang-key="loginShopName">‡¶∂‡¶´‡¶ø‡¶ï‡ßÅ‡¶≤ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ï‡¶∞‡ßç‡¶®‡¶æ‡¶∞</h2>
            <p data-lang-key="loginMsg">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            <form id="login-form" autocomplete="off">
                <div class="input-group">
                    <span class="input-icon">üë§</span>
                    <input type="text" id="username" data-lang-placeholder="loginUsernamePlaceholder" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø (‡¶®‡¶æ‡¶Æ/‡¶á‡¶Æ‡ßá‡¶á‡¶≤)" required>
                </div>
                <div class="input-group">
                    <span class="input-icon">üîí</span>
                    <input type="password" id="password" data-lang-placeholder="loginPasswordPlaceholder" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" autocomplete="new-password" required>
                </div>
                <button type="submit" class="login-btn" data-lang-key="loginBtn">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <p id="login-error" data-lang-key="loginError">‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</p>
            </form>
        </div>
    </div>

    <div id="main-app">
        <header class="app-header no-print">
            <div class="header-left-section">
                <span class="menu-toggle">&#9776;</span>
                <img id="header-logo" src="" alt="‡¶≤‡ßã‡¶ó‡ßã" style="display: none;">
                <h1 id="shop-name-header">‡¶∂‡¶´‡¶ø‡¶ï‡ßÅ‡¶≤ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ï‡¶∞‡ßç‡¶®‡¶æ‡¶∞</h1>
            </div>
            <div class="header-right-section">
                <span id="logged-in-user-display" style="font-weight: bold; color: var(--primary-color);"></span>
                <div class="language-switcher">
                    <select id="language-selector">
                        <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                        <option value="en">English</option>
                    </select>
                </div>
                <a href="#" id="logout-btn" class="logout-btn" data-lang-key="logoutBtn">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</a>
            </div>
        </header>

        <nav class="app-nav no-print">
             <ul>
                <li><a href="#dashboard" class="nav-link"><span>üìä</span><span class="nav-text" data-lang-key="navDashboard">‡¶°‡ßç‡¶Ø‡¶æ‡¶∏‡¶¨‡ßã‡¶∞‡ßç‡¶°</span></a></li>
                <li><a href="#pos-system" class="nav-link"><span>üí≥</span><span class="nav-text" data-lang-key="navPosSystem">POS ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</span></a></li>
                <li><a href="#pos-sales-list" class="nav-link"><span>üìã</span><span class="nav-text" data-lang-key="navPosSalesList">POS ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</span></a></li>
                <li><a href="#sell" class="nav-link"><span>üí∏</span><span class="nav-text" data-lang-key="navSellManual">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø (‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤)</span></a></li>
                <li><a href="#purchase" class="nav-link"><span>üõí</span><span class="nav-text" data-lang-key="navPurchase">‡¶ï‡ßç‡¶∞‡ßü</span></a></li>
                <li><a href="#add-product" class="nav-link"><span>üì¶</span><span class="nav-text" data-lang-key="navAddProduct">‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó</span></a></li>
                <li><a href="#add-supplier" class="nav-link"><span>üöö</span><span class="nav-text" data-lang-key="navAddSupplier">‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó</span></a></li>
                <li><a href="#add-customer" class="nav-link"><span>üë•</span><span class="nav-text" data-lang-key="navAddCustomer">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó</span></a></li>
                <li><a href="#add-category" class="nav-link"><span>üóÇÔ∏è</span><span class="nav-text">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</span></a></li>
                <li><a href="#add-brand" class="nav-link"><span>üè∑Ô∏è</span><span class="nav-text">‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶°</span></a></li>
                <li><a href="#stock" class="nav-link"><span>üìù</span><span class="nav-text" data-lang-key="navStock">‡¶∏‡ßç‡¶ü‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</span></a></li>
                <li><a href="#due-list" class="nav-link"><span>Êî∂Ê¨æ</span><span class="nav-text" data-lang-key="navDueList">‡¶¨‡¶æ‡¶ï‡¶ø ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</span></a></li>
                <li><a href="#mobile-finance" class="nav-link"><span>üè¶</span><span class="nav-text" data-lang-key="navMobileFinance">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏</span></a></li>
                <li><a href="#flexiload" class="nav-link"><span>üì±</span><span class="nav-text" data-lang-key="navFlexiload">‡¶´‡ßá‡¶ï‡ßç‡¶∏‡¶ø‡¶≤‡ßã‡¶°</span></a></li>
                <li><a href="#computer-income" class="nav-link"><span>üíª</span><span class="nav-text" data-lang-key="navComputerIncome">‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</span></a></li>
                <li><a href="#shop-account" class="nav-link"><span>üßæ</span><span class="nav-text" data-lang-key="navShopAccount">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</span></a></li>
                <li><a href="#report" class="nav-link"><span>üìÑ</span><span class="nav-text" data-lang-key="navReport">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</span></a></li>
                <li><a href="#profile" class="nav-link"><span>üë§</span><span class="nav-text" data-lang-key="navProfile">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span></a></li>
                <li><a href="#settings" class="nav-link"><span>‚öôÔ∏è</span><span class="nav-text" data-lang-key="navSettings">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span></a></li>
                <li><a href="#user-management" class="nav-link"><span>üë®‚Äçüíº</span><span class="nav-text" data-lang-key="navUserManagement">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</span></a></li>
                <li><a href="#units" class="nav-link"><span>üìè</span><span class="nav-text" data-lang-key="navUnits">Units</span></a></li>
                <li><a href="#sms-sender" class="nav-link"><span>üí¨</span><span class="nav-text" data-lang-key="navSmsSender">Send SMS/WhatsApp</span></a></li>
                <li><a href="#sms-templates" class="nav-link"><span>üìù</span><span class="nav-text" data-lang-key="navSmsTemplates">SMS ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü</span></a></li>
            </ul>
        </nav>
        
        <main class="app-content">
            <section id="dashboard" class="content-section">
                <h2 class="content-header" data-lang-key="dashboardHeader">‡¶°‡ßç‡¶Ø‡¶æ‡¶∏‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
                <div class="dashboard-filter-container no-print">
                    <button class="dashboard-filter-btn active" data-period="today">‡¶Ü‡¶ú</button>
                    <button class="dashboard-filter-btn" data-period="weekly">‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï</button>
                    <button class="dashboard-filter-btn" data-period="monthly">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï</button>
                    <button class="dashboard-filter-btn" data-period="yearly">‡¶¨‡¶æ‡ßé‡¶∏‡¶∞‡¶ø‡¶ï</button>
                    <button class="dashboard-filter-btn" data-period="all">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü</button>
                </div>
                <div class="dashboard-cards">
                    <div class="card c1"><div class="card-icon">üí∞</div><div class="card-content"><h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø</h3><p id="today-sale">‡ß¶.‡ß¶‡ß¶</p></div></div>
                    <div class="card c2"><div class="card-icon">üõí</div><div class="card-content"><h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ï‡ßç‡¶∞‡ßü</h3><p id="today-purchase">‡ß¶.‡ß¶‡ß¶</p></div></div>
                    <div class="card c3"><div class="card-icon">üìà</div><div class="card-content"><h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶æ‡¶≠</h3><p id="today-profit">‡ß¶.‡ß¶‡ß¶</p></div></div>
                    <div class="card c6"><div class="card-icon">üí∏</div><div class="card-content"><h3 data-lang-key="dashTotalDue">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø (‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞)</h3><p id="total-due-from-customers">‡ß¶.‡ß¶‡ß¶</p></div></div>
                    <div class="card c9"><div class="card-icon">üè¶</div><div class="card-content"><h3 data-lang-key="dashMobileFinanceBalance">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</h3><p id="mobile-finance-balance">‡ß¶.‡ß¶‡ß¶</p></div></div>
                    <div class="card c4"><div class="card-icon">üë•</div><div class="card-content"><h3 data-lang-key="dashTotalCustomers">‡¶Æ‡ßã‡¶ü ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞</h3><p id="total-customers">‡ß¶</p></div></div>
                    <div class="card c5"><div class="card-icon">üöö</div><div class="card-content"><h3 data-lang-key="dashTotalSuppliers">‡¶Æ‡ßã‡¶ü ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞</h3><p id="total-suppliers">‡ß¶</p></div></div>
                    <div class="card c7"><div class="card-icon">üßæ</div><div class="card-content"><h3>‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ñ‡¶∞‡¶ö</h3><p id="monthly-shop-expense">‡ß¶.‡ß¶‡ß¶</p></div></div>
                    <div class="card c8"><div class="card-icon">üíª</div><div class="card-content"><h3>‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</h3><p id="total-computer-income">‡ß¶.‡ß¶‡ß¶</p></div></div>
                </div>
            </section>
            
            <section id="pos-system" class="content-section">
                <h2 class="content-header" data-lang-key="posHeader">‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡¶´ ‡¶∏‡ßá‡¶≤ (POS)</h2>
                <div class="pos-layout">
                    <!-- ‡¶¨‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶ï: ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶≤ -->
                    <div id="pos-cart-area">
                        <form id="pos-checkout-form">
                            <div class="form-group">
                                <label data-lang-key="posSavedCustomer">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞</label>
                                <select id="pos-customer-saved"></select>
                            </div>
                             <div class="form-group">
                                <label data-lang-key="posNewCustomer">‡¶Ö‡¶•‡¶¨‡¶æ, ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                                <input type="text" id="pos-customer-new" data-lang-placeholder="posNewCustomerPlaceholder" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                            </div>
                        </form>
                        <div class="table-container">
                            <table id="pos-cart-table">
                                <thead><tr><th data-lang-key="posTblProduct">‡¶™‡¶£‡ßç‡¶Ø</th><th data-lang-key="posTblQty">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th data-lang-key="posTblPrice">‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</th><th data-lang-key="posTblAction">‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="pos-summary">
                             <div class="form-group"><label data-lang-key="posCartTotal">‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label><input type="number" id="pos-total" readonly></div>
                             <div class="form-group"><label data-lang-key="posPreviousDue">‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø</label><input type="number" id="pos-previous-due" readonly></div>
                             <div class="form-group"><label data-lang-key="posDiscount">‡¶õ‡¶æ‡ßú</label><input type="number" id="pos-discount" min="0" value="0" required></div>
                             <div class="form-group"><label data-lang-key="posPaidToday">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶Æ‡¶æ</label><input type="number" id="pos-paid" min="0" value="0" required></div>
                             <div class="form-group"><label data-lang-key="posTotalDueFinal">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø</label><input type="number" id="pos-due" readonly></div>
                             <div class="pos-button-group" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                                <button type="button" id="pos-view-btn" class="btn btn-info" data-lang-key="posViewInvoiceBtn">‡¶á‡¶®‡¶≠‡ßü‡ßá‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                                <button type="button" id="pos-save-btn" class="btn btn-primary" data-lang-key="posSaveBtn">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                                <button type="button" id="pos-save-print-btn" class="btn btn-success" data-lang-key="posSavePrintBtn">‡¶∏‡ßá‡¶≠ ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</button>
                            </div>
                        </div>
                    </div>

                    <!-- ‡¶°‡¶æ‡¶® ‡¶¶‡¶ø‡¶ï: ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ -->
                    <div>
                        <div class="form-container" style="padding: 15px; margin-bottom: 20px;">
                            <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 15px; align-items: center;">
                                <div class="form-group">
                                    <label>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</label>
                                    <select id="pos-category-filter" onchange="filterAndDisplayPosProducts()"></select>
                                </div>
                                <div class="form-group">
                                    <label>‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶°</label>
                                    <select id="pos-brand-filter" onchange="filterAndDisplayPosProducts()"></select>
                                </div>
                            </div>
                        </div>
                        <div id="pos-product-grid"></div>
                    </div>
                </div>
            </section>

            <section id="pos-sales-list" class="content-section">
                <h2 class="content-header" data-lang-key="posSalesListHeader">POS ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
                 <div class="form-container" style="padding:15px; margin-bottom: 20px;"><input type="text" id="pos-sales-list-search-input" onkeyup="filterTable('pos-sales-table', 2)" data-lang-placeholder="posSalesSearchPlaceholder" placeholder="‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..."></div>
                <div class="table-container">
                    <table id="pos-sales-table">
                        <thead>
                            <tr>
                                <th data-lang-key="posSalesTblInvoice">‡¶á‡¶®‡¶≠‡ßü‡ßá‡¶∏ ‡¶®‡¶Ç</th>
                                <th data-lang-key="posSalesTblDate">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th data-lang-key="posSalesTblCustomer">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞</th>
                                <th data-lang-key="posSalesTblSeller">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü‡¶ï‡¶æ‡¶∞‡ßÄ</th>
                                <th data-lang-key="posSalesTblTotal">‡¶Æ‡ßã‡¶ü</th>
                                <th data-lang-key="posSalesTblDiscount">‡¶õ‡¶æ‡ßú</th>
                                <th data-lang-key="posSalesTblPaid">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</th>
                                <th data-lang-key="posSalesTblDue">‡¶¨‡¶æ‡¶ï‡¶ø</th>
                                <th data-lang-key="posSalesTblAction">‡¶è‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
            
            <section id="sell" class="content-section"><h2 class="content-header">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤)</h2><div class="form-container"><form id="sell-form" class="form-grid"><div class="form-group"><label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="sell-date" readonly></div><div class="form-group"><label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><select id="sell-customer" required></select></div><div class="form-group"><label>‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="sell-product-search" list="product-list" required><datalist id="product-list"></datalist></div><div class="form-group"><label>‡¶è‡¶ï‡¶ï ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label><input type="number" id="sell-price" readonly></div><div class="form-group"><label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label><input type="number" id="sell-quantity" min="1" required></div><div class="form-group"><label>‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label><input type="number" id="sell-total" readonly></div><div class="form-group"><label>‡¶ú‡¶Æ‡¶æ</label><input type="number" id="sell-paid" min="0" value="0" required></div><div class="form-group"><label>‡¶¨‡¶æ‡¶ï‡¶ø</label><input type="number" id="sell-due" readonly></div><div class="form-group" style="align-self: end;"><button type="submit" id="sell-submit-btn" class="btn btn-primary">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></form></div><div class="table-container"><table id="sell-table"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞</th><th>‡¶™‡¶£‡ßç‡¶Ø</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶Æ‡ßã‡¶ü</th><th>‡¶ú‡¶Æ‡¶æ</th><th>‡¶¨‡¶æ‡¶ï‡¶ø</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead><tbody></tbody></table></div></section>
            <section id="purchase" class="content-section"><h2 class="content-header">‡¶ï‡ßç‡¶∞‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</h2><div class="form-container"><form id="purchase-form" class="form-grid"><div class="form-group"><label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="purchase-date" readonly></div><div class="form-group"><label>‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><select id="purchase-supplier" required></select></div><div class="form-group"><label>‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><select id="purchase-product" required></select></div><div class="form-group"><label>‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label><input type="number" id="purchase-price" required></div><div class="form-group"><label>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label><input type="number" id="purchase-quantity" min="1" required></div><div class="form-group"><label>‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label><input type="number" id="purchase-total" readonly></div><div class="form-group"><label>‡¶ú‡¶Æ‡¶æ</label><input type="number" id="purchase-paid" min="0" value="0" required></div><div class="form-group"><label>‡¶¨‡¶æ‡¶ï‡¶ø</label><input type="number" id="purchase-due" readonly></div><div class="form-group" style="align-self: end;"><button type="submit" id="purchase-submit-btn" class="btn btn-primary">‡¶ï‡ßç‡¶∞‡ßü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></form></div><div class="table-container"><table id="purchase-table"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞</th><th>‡¶™‡¶£‡ßç‡¶Ø</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶Æ‡ßã‡¶ü</th><th>‡¶ú‡¶Æ‡¶æ</th><th>‡¶¨‡¶æ‡¶ï‡¶ø</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead><tbody></tbody></table></div></section>
            
            <section id="add-product" class="content-section">
                <h2 class="content-header" data-lang-key="productHeader">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <div class="form-container">
                    <img id="product-image-preview" src="https://via.placeholder.com/150" alt="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â">
                    <form id="product-form" class="form-grid">
                        <div class="form-group"><label data-lang-key="productNameLabel">‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="product-name" required></div>
                        <div class="form-group"><label>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</label><select id="product-category"></select></div>
                        <div class="form-group"><label>‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶°</label><select id="product-brand"></select></div>
                        <div class="form-group"><label data-lang-key="purchaseCostLabel">‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label><input type="number" id="product-purchase-cost" min="0" required></div>
                        <div class="form-group"><label data-lang-key="sellPriceLabel">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</label><input type="number" id="product-sell-price" min="0" required></div>
                        <div class="form-group">
                            <label data-lang-key="unitLabel">Unit</label>
                            <select id="product-unit" required></select>
                        </div>
                        <div class="form-group"><label data-lang-key="initialStockLabel">‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶ï</label><input type="number" id="product-stock" min="0" value="0" required></div>
                        <div class="form-group" style="grid-column: 1 / -1;"><label data-lang-key="productImageLabel">‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø</label><input type="file" id="product-image" accept="image/*"></div>
                        <div class="form-group" style="align-self: end; grid-column: 1 / -1;"><button type="submit" id="product-submit-btn" class="btn btn-primary" data-lang-key="addProductBtn">‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
                    </form>
                </div>
                <div class="table-container">
                    <table id="product-table">
                        <thead>
                            <tr>
                                <th data-lang-key="productTblImage">‡¶õ‡¶¨‡¶ø</th>
                                <th data-lang-key="productTblName">‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th>
                                <th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th>
                                <th>‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶°</th>
                                <th data-lang-key="productTblPurchaseCost">‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</th>
                                <th data-lang-key="productTblSellPrice">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</th>
                                <th data-lang-key="productTblUnit">Unit</th>
                                <th data-lang-key="productTblStock">‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶ï</th>
                                <th data-lang-key="productTblAction">‡¶è‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
            
            <section id="add-supplier" class="content-section"><h2 class="content-header">‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2><div class="form-container"><form id="supplier-form" class="form-grid"><div class="form-group"><label>‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</label><input type="text" id="supplier-sl" readonly></div><div class="form-group"><label>‡¶®‡¶æ‡¶Æ</label><input type="text" id="supplier-name" required></div><div class="form-group"><label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</label><input type="tel" id="supplier-mobile"></div><div class="form-group" style="align-self: end;"><button type="submit" id="supplier-submit-btn" class="btn btn-primary">‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó</button></div></form></div><div class="table-container"><table id="supplier-table"><thead><tr><th>‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</th><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead><tbody></tbody></table></div></section>
            <section id="add-customer" class="content-section"><h2 class="content-header">‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2><div class="form-container"><form id="customer-form" class="form-grid"><div class="form-group"><label>‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</label><input type="text" id="customer-sl" readonly></div><div class="form-group"><label>‡¶®‡¶æ‡¶Æ</label><input type="text" id="customer-name" required></div><div class="form-group"><label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</label><input type="tel" id="customer-mobile"></div><div class="form-group"><label>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input type="text" id="customer-address"></div><div class="form-group" style="align-self: end;"><button type="submit" id="customer-submit-btn" class="btn btn-primary">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó</button></div></form></div><div class="table-container"><table id="customer-table"><thead><tr><th>‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</th><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</th><th>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead><tbody></tbody></table></div></section>
            
            <section id="add-category" class="content-section">
                <h2 class="content-header">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
                <div class="form-container">
                    <form id="category-form" class="form-grid" style="grid-template-columns: 1fr 2fr 1fr;">
                        <div class="form-group">
                            <label>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="category-name" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label><input type="text" id="category-description" placeholder="‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï">
                        </div>
                        <div class="form-group" style="align-self: end;">
                            <button type="submit" id="category-submit-btn" class="btn btn-primary">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <h3 style="margin: 20px 0;">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                    <table id="category-table">
                        <thead><tr><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="add-brand" class="content-section">
                <h2 class="content-header">‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶° ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
                <div class="form-container">
                    <form id="brand-form" class="form-grid" style="grid-template-columns: 1fr 2fr 1fr;">
                        <div class="form-group">
                            <label>‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="brand-name" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label><input type="text" id="brand-description" placeholder="‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï">
                        </div>
                        <div class="form-group" style="align-self: end;">
                            <button type="submit" id="brand-submit-btn" class="btn btn-primary">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <h3 style="margin: 20px 0;">‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶° ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                    <table id="brand-table">
                        <thead><tr><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="stock" class="content-section"><h2 class="content-header">‡¶∏‡ßç‡¶ü‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h2><div class="form-container" style="padding:15px; margin-bottom: 20px;"><input type="text" id="stock-search-input" onkeyup="filterTable('stock-table', 0)" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..."></div><div class="table-container"><table id="stock-table"><thead><tr><th>‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶ï</th><th>‡¶Æ‡ßã‡¶ü ‡¶ï‡ßç‡¶∞‡ßü</th><th>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü</th><th>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï</th></tr></thead><tbody></tbody></table></div></section>
            <section id="due-list" class="content-section">
                <h2 class="content-header">‡¶¨‡¶æ‡¶ï‡¶ø ‡¶•‡¶æ‡¶ï‡¶æ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
                <div class="form-container" style="padding:15px; margin-bottom: 20px;">
                    <input type="text" id="due-list-search-input" onkeyup="filterTable('due-list-table', 1)" placeholder="‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
                </div>
                <div class="table-container">
                    <table id="due-list-table">
                        <thead>
                            <tr>
                                <th>‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</th>
                                <th>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th>
                                <th>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø</th>
                                <th>‡¶è‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
            
            <section id="mobile-finance" class="content-section">
                <h2 class="content-header" data-lang-key="mobileFinanceHeader">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h2>
                <div class="form-container">
                    <form id="mobile-finance-form" class="form-grid">
                        <div class="form-group">
                            <label data-lang-key="mfDateLabel">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                            <input type="date" id="mf-date" required>
                        </div>
                        <div class="form-group">
                            <label data-lang-key="mfTypeLabel">‡¶ß‡¶∞‡¶£</label>
                            <select id="mf-type" required>
                                <option value="Cash In">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶á‡¶®</option>
                                <option value="Cash Out">‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ü‡¶â‡¶ü</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label data-lang-key="mfServiceLabel">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</label>
                            <select id="mf-service" required>
                                <option value="bKash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                                <option value="Nagad">‡¶®‡¶ó‡¶¶</option>
                                <option value="Rocket">‡¶∞‡¶ï‡ßá‡¶ü</option>
                                <option value="Upay">‡¶â‡¶™‡¶æ‡ßü</option>
                                <option value="Other">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label data-lang-key="mfAmountLabel">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
                            <input type="number" id="mf-amount" min="0" required>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label data-lang-key="mfDescLabel">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                            <input type="text" id="mf-description" data-lang-placeholder="optionalPlaceholder" placeholder="‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï">
                        </div>
                        <div class="form-group" style="align-self: end; grid-column: 1 / -1;">
                            <button type="submit" id="mf-submit-btn" class="btn btn-primary" data-lang-key="saveBtn">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <table id="mobile-finance-table">
                        <thead>
                            <tr>
                                <th data-lang-key="mfTblDate">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th data-lang-key="mfTblType">‡¶ß‡¶∞‡¶£</th>
                                <th data-lang-key="mfTblService">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</th>
                                <th data-lang-key="mfTblAmount">‡¶ü‡¶æ‡¶ï‡¶æ</th>
                                <th data-lang-key="mfTblDesc">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                                <th data-lang-key="action">‡¶è‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="flexiload" class="content-section">
                <h2 class="content-header">‡¶´‡ßá‡¶ï‡ßç‡¶∏‡¶ø‡¶≤‡ßã‡¶° ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h2>
                <div class="form-container" style="margin-bottom: 20px; background-color: var(--info-color); color: white; text-align: center;">
                    <h4 style="margin:0;">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span id="flexiload-current-balance" style="font-size: 1.5em; font-weight: bold;">‡ß¶.‡ß¶‡ß¶</span> ‡¶ü‡¶æ‡¶ï‡¶æ</h4>
                </div>
                <div class="form-container">
                    <form id="flexiload-balance-form" class="form-grid" style="grid-template-columns: 2fr 1fr; align-items: end;">
                        <div class="form-group">
                            <label>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                            <input type="number" id="flexiload-add-balance-amount" min="1" required placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-info">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ø‡ßã‡¶ó</button>
                        </div>
                    </form>
                </div>
                <div class="form-container">
                    <h3 style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <form id="flexiload-form" class="form-grid">
                        <div class="form-group"><label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label><input type="tel" id="flexiload-mobile" required></div>
                        <div class="form-group"><label>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label><input type="number" id="flexiload-amount" min="10" required></div>
                        <div class="form-group"><label>‡¶ï‡¶Æ‡¶ø‡¶∂‡¶®</label><input type="number" id="flexiload-commission" min="0" value="0" step="0.01" required></div>
                        <div class="form-group"><label>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</label><select id="flexiload-status"><option value="Success">Success</option><option value="Unsuccess">Unsuccess</option></select></div>
                        <div class="form-group" style="align-self: end;"><button type="submit" id="flexiload-submit-btn" class="btn btn-primary">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
                    </form>
                </div>
                <div class="table-container">
                    <h3 style="margin-top:20px;">‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                    <table id="flexiload-table">
                        <thead>
                            <tr><th>‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</th><th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th><th>‡¶ï‡¶Æ‡¶ø‡¶∂‡¶®</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
            <section id="computer-income" class="content-section"><h2 class="content-header">‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h2><div class="form-container"><form id="computer-income-form" class="form-grid"><div class="form-group"><label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="ci-date" readonly></div><div class="form-group"><label>‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><select id="ci-work-name" required><option value="‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</option><option value="‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï">‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï</option><option value="‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡¶æ">‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡¶æ</option><option value="‡¶´‡¶ü‡ßã ‡¶ï‡¶™‡¶ø">‡¶´‡¶ü‡ßã ‡¶ï‡¶™‡¶ø</option><option value="‡¶≤‡ßç‡¶Ø‡¶æ‡¶Æ‡ßã‡¶®‡ßá‡¶ü‡¶ø‡¶Ç">‡¶≤‡ßç‡¶Ø‡¶æ‡¶Æ‡ßã‡¶®‡ßá‡¶ü‡¶ø‡¶Ç</option><option value="‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</option></select></div><div class="form-group"><label>‡¶ü‡¶æ‡¶ï‡¶æ</label><input type="number" id="ci-amount" required></div><div class="form-group" style="align-self: end;"><button type="submit" id="ci-submit-btn" class="btn btn-primary">‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶Ø‡ßã‡¶ó</button></div></form></div><div class="table-container"><table id="ci-table"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead><tbody></tbody></table></div></section>
            <section id="shop-account" class="content-section"><h2 class="content-header">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (‡¶ñ‡¶∞‡¶ö)</h2><div class="form-container"><form id="shop-expense-form" class="form-grid"><div class="form-group"><label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="se-date" required></div><div class="form-group"><label>‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ß‡¶∞‡¶£</label><select id="se-type" required><option value="‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶≠‡¶æ‡ßú‡¶æ">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶≠‡¶æ‡ßú‡¶æ</option><option value="‡¶ï‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶≤">‡¶ï‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶≤</option><option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</option></select></div><div class="form-group"><label>‡¶ü‡¶æ‡¶ï‡¶æ</label><input type="number" id="se-amount" required></div><div class="form-group" style="align-self: end;"><button type="submit" id="se-submit-btn" class="btn btn-primary">‡¶ñ‡¶∞‡¶ö ‡¶Ø‡ßã‡¶ó</button></div></form></div><div class="table-container"><table id="se-table"><thead><tr><th>‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</th><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ß‡¶∞‡¶£</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead><tbody></tbody></table></div></section>
            
            <section id="report" class="content-section">
                <h2 class="content-header">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h2>
                <div class="form-container no-print">
                    <form id="report-form" class="form-grid">
                        <div class="form-group"><label>‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="report-start-date" required></div>
                        <div class="form-group"><label>‡¶∂‡ßá‡¶∑‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="report-end-date" required></div>
                        <div class="form-group" style="align-self: end;">
                            <button type="submit" class="btn btn-primary">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                            <button type="button" id="print-report-btn" class="btn btn-warning" style="margin-left: 10px; display:none;">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        </div>
                    </form>
                </div>
                <div id="report-output">
                    <p>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßá "‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                </div>
                
                <div id="report-charts-container" style="margin-top: 30px; display:none;">
                    <div class="form-container">
                         <h3 style="text-align:center; margin-bottom: 20px;">‡¶Ü‡ßü ‡¶¨‡¶®‡¶æ‡¶Æ ‡¶¨‡ßç‡¶Ø‡ßü‡ßá‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
                         <canvas id="incomeExpenseChart"></canvas>
                    </div>
                    <div class="form-container" style="margin-top: 20px;">
                        <h3 style="text-align:center; margin-bottom: 20px;">‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶§ ‡¶™‡¶£‡ßç‡¶Ø</h3>
                        <canvas id="topProductsChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="profile" class="content-section"><h2 class="content-header">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2><div class="profile-container form-container"><h3>‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶≤‡ßã‡¶ó‡ßã</h3><img id="logo-preview" src="https://via.placeholder.com/200" alt="‡¶≤‡ßã‡¶ó‡ßã ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â"><input type="file" id="logo-upload" accept="image/*" style="margin-top: 15px;"></div></section>
            <section id="settings" class="content-section">
                <h2 class="content-header">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h2>
                <div class="form-container">
                    <h3>‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                    <form id="general-settings-form" class="form-grid" style="margin-bottom: 30px;">
                        <div class="form-group"><label for="shop-name">‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="shop-name" required></div>
                        <div class="form-group"><label for="shop-address">‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input type="text" id="shop-address" placeholder="‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ, ‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ, ‡¶ú‡ßá‡¶≤‡¶æ"></div>
                        <div class="form-group"><label for="shop-mobile">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Ç</label><input type="tel" id="shop-mobile" placeholder="‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞"></div>
                        <div class="form-group"><label for="shop-proprietor">‡¶™‡ßç‡¶∞‡¶™‡¶æ‡¶á‡¶ü‡¶∞ ‡¶è‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="shop-proprietor" placeholder="‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ"></div>
                        <div class="form-group"><label for="sms-gateway-url">SMS ‡¶ó‡ßá‡¶ü‡¶ì‡ßü‡ßá URL</label><input type="text" id="sms-gateway-url" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: http://192.168.0.105:5000"></div>
                        <div class="form-group" style="grid-column: 1 / -1; align-self: end; margin-top: 15px;"><button type="submit" class="btn btn-primary">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
                    </form>
                    <h3>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® (Super Admin)</h3>
                    <form id="password-change-form" class="form-grid">
                        <div class="form-group"><label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="current-password" required></div>
                        <div class="form-group"><label>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="new-password" required></div>
                        <div class="form-group" style="align-self: end;"><button type="submit" class="btn btn-primary">‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
                    </form>

                    <!-- ‚úÖ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶¨‡¶ø‡¶™‡¶¶‡¶ú‡¶®‡¶ï ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ (Dangerous Zone) ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                    <div id="danger-zone" style="margin-top: 40px; border-top: 2px solid var(--danger-color); padding-top: 20px; display: none;">
                        <h3>‡¶¨‡¶ø‡¶™‡¶¶‡¶ú‡¶®‡¶ï ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ</h3>
                        <p style="margin-bottom: 15px;">‡¶è‡¶á ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø (‡¶™‡¶£‡ßç‡¶Ø, ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø, ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø) ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§</p>
                        <button id="delete-all-data-btn" class="btn" style="background-color: var(--danger-color); width: 100%;">‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
                    </div>

                </div>
            </section>
            <section id="user-management" class="content-section">
                <h2 class="content-header">‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <div class="form-container">
                    <form id="user-form" class="form-grid">
                        <div class="form-group"><label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input type="text" id="user-name" required></div>
                        <div class="form-group"><label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</label><input type="tel" id="user-mobile"></div>
                        <div class="form-group"><label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label><input type="email" id="user-email"></div>
                        <div class="form-group"><label>‡¶≠‡ßÇ‡¶Æ‡¶ø‡¶ï‡¶æ (Role)</label><select id="user-role" required><option value="Admin">Admin</option><option value="Manager">Manager</option><option value="Salesman">Salesman</option></select></div>
                        <div class="form-group"><label>‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label><input type="password" id="user-pass" required></div>
                        <div class="form-group" style="align-self: end;"><button type="submit" id="user-submit-btn" class="btn btn-primary">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
                    </form>
                </div>
                <div class="table-container">
                    <h3 style="margin: 20px 0;">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                    <table id="user-table">
                        <thead><tr><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</th><th>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</th><th>‡¶≠‡ßÇ‡¶Æ‡¶ø‡¶ï‡¶æ (Role)</th><th>‡¶è‡¶ï‡¶∂‡¶®</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
            <section id="units" class="content-section">
                <h2 class="content-header" data-lang-key="unitsHeader">Unit Management</h2>
                <div class="form-container">
                    <form id="unit-form" class="form-grid" style="grid-template-columns: 1fr 2fr 1fr;">
                        <div class="form-group">
                            <label data-lang-key="unitNameLabel">Unit Name (e.g., Kg, Pcs, Box)</label><input type="text" id="unit-name" required>
                        </div>
                        <div class="form-group">
                            <label data-lang-key="unitDescLabel">Description</label><input type="text" id="unit-description" data-lang-placeholder="optionalPlaceholder" placeholder="Optional">
                        </div>
                        <div class="form-group" style="align-self: end;">
                            <button type="submit" id="unit-submit-btn" class="btn btn-primary" data-lang-key="saveUnitBtn">Save Unit</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <h3 style="margin: 20px 0;" data-lang-key="unitListHeader">Unit List</h3>
                    <table id="unit-table">
                        <thead><tr><th data-lang-key="unitTblName">Unit Name</th><th data-lang-key="unitTblDesc">Description</th><th data-lang-key="unitTblAction">Action</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
            <section id="sms-sender" class="content-section">
                <h2 class="content-header">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡¶ï‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®</h2>
                <div class="form-container">
                    <p style="margin-bottom: 20px; padding: 10px; background-color: #eaf5fb; border-left: 4px solid var(--primary-color);">
                        ‡¶è‡¶á ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡¶ü‡¶ø WhatsApp "Click-to-Chat" ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡•§ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá WhatsApp ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ü‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§
                    </p>
                    <form id="sms-form" class="form-grid" style="grid-template-columns: 1fr;">
                        <div class="form-group"><label>‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</label><select id="sms-customer-select" required></select></div>
                        <div class="form-group"><label>‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</label><textarea id="sms-message-body" rows="6" style="width:100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); resize: vertical; font-family: inherit;" required placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea></div>
                        <div class="form-group" style="align-self: end;"><button type="button" id="send-whatsapp-btn" class="btn btn-success" style="width: 100%; padding: 15px; font-size: 1.1em;">WhatsApp-‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button></div>
                    </form>
                </div>
            </section>
            <section id="sms-templates" class="content-section">
                <h2 class="content-header">SMS ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
                <div class="form-container">
                    <form id="template-form" class="form-grid">
                        <div class="form-group">
                            <label>‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                            <input type="text" id="template-name" required placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡ßá‡¶∞ ‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞">
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</label>
                            <textarea id="template-body" rows="4" style="width:100%;" required></textarea>
                            <small>‡¶Ü‡¶™‡¶®‡¶ø `{customer_name}` ‡¶è‡¶¨‡¶Ç `{due_amount}` ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§ ‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶™‡ßç‡¶∞‡¶ø‡ßü {customer_name}, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ï‡ßá‡ßü‡¶æ {due_amount} ‡¶ü‡¶æ‡¶ï‡¶æ‡•§</small>
                        </div>
                        <div class="form-group" style="align-self: end;">
                            <button type="submit" id="template-submit-btn" class="btn btn-primary">‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <h3 style="margin: 20px 0;">‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                    <table id="template-table">
                        <thead>
                            <tr>
                                <th>‡¶®‡¶æ‡¶Æ</th>
                                <th>‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</th>
                                <th>‡¶è‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const firebaseConfig = {
            apiKey: "AIzaSyCIQv8TK8lxUaZNMG0PFG0meuVpvEfes78",
            authDomain: "shafiqul-inventory-app.firebaseapp.com",
            databaseURL: "https://shafiqul-inventory-app-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "shafiqul-inventory-app",
            storageBucket: "shafiqul-inventory-app.appspot.com",
            messagingSenderId: "685781284453",
            appId: "1:685781284453:web:d044a51e70e4b26d6a388c",
            measurementId: "G-2FWT2WZL61"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        const translations = {
            editBtn: { bn: '‡¶á‡¶°‡¶ø‡¶ü', en: 'Edit' }, deleteBtn: { bn: '‡¶°‡¶ø‡¶≤‡¶ø‡¶ü', en: 'Delete' }, printBtn: { bn: '‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü', en: 'Print' },
            action: { bn: '‡¶è‡¶ï‡¶∂‡¶®', en: 'Action' }, saveBtn: { bn: '‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Save' }, updateBtn: { bn: '‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Update' },
            optionalPlaceholder: { bn: '‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï', en: 'Optional'}, welcomeMsg: { bn: '‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ,', en: 'Welcome,' },
            loginShopName: { bn: '‡¶∂‡¶´‡¶ø‡¶ï‡ßÅ‡¶≤ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ï‡¶∞‡ßç‡¶®‡¶æ‡¶∞', en: 'Shafiqul Electronic Corner' }, loginMsg: { bn: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Login to your account' },
            loginUsernamePlaceholder: { bn: '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø (‡¶®‡¶æ‡¶Æ/‡¶á‡¶Æ‡ßá‡¶á‡¶≤)', en: 'User ID (Name/Email)' }, loginPasswordPlaceholder: { bn: '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°', en: 'Password' },
            loginBtn: { bn: '‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Login' }, loginError: { bn: '‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°', en: 'Incorrect User ID or Password' },
            logoutBtn: { bn: '‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü', en: 'Logout' },
            navDashboard: { bn: '‡¶°‡ßç‡¶Ø‡¶æ‡¶∏‡¶¨‡ßã‡¶∞‡ßç‡¶°', en: 'Dashboard' }, navPosSystem: { bn: 'POS ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ', en: 'POS System' },
            navPosSalesList: { bn: 'POS ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ', en: 'POS Sales List' }, navSellManual: { bn: '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø (‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤)', en: 'Sell (Manual)' },
            navPurchase: { bn: '‡¶ï‡ßç‡¶∞‡ßü', en: 'Purchase' }, navAddProduct: { bn: '‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó', en: 'Add Product' },
            navAddSupplier: { bn: '‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó', en: 'Add Supplier' }, navAddCustomer: { bn: '‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó', en: 'Add Customer' },
            navStock: { bn: '‡¶∏‡ßç‡¶ü‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨', en: 'Stock' }, navDueList: { bn: '‡¶¨‡¶æ‡¶ï‡¶ø ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ', en: 'Due List' },
            navMobileFinance: { bn: '‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏', en: 'Mobile Finance' },
            navFlexiload: { bn: '‡¶´‡ßá‡¶ï‡ßç‡¶∏‡¶ø‡¶≤‡ßã‡¶°', en: 'Flexiload' }, navComputerIncome: { bn: '‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ', en: 'Computer Income' },
            navShopAccount: { bn: '‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨', en: 'Shop Account' }, navReport: { bn: '‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü', en: 'Report' },
            navProfile: { bn: '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤', en: 'Profile' }, navSettings: { bn: '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏', en: 'Settings' },
            navUserManagement: { bn: '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü', en: 'User Management' }, navUnits: { bn: 'Units', en: 'Units' },
            navSmsSender: { bn: 'Send SMS/WhatsApp', en: 'Send SMS/WhatsApp' }, navSmsTemplates: { bn: 'SMS ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü', en: 'SMS Templates' },
            dashboardHeader: { bn: '‡¶°‡ßç‡¶Ø‡¶æ‡¶∏‡¶¨‡ßã‡¶∞‡ßç‡¶°', en: 'Dashboard' }, dashTodaysSale: { bn: '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø', en: "Today's Sale" },
            dashTodaysPurchase: { bn: '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ï‡ßç‡¶∞‡ßü', en: "Today's Purchase" }, dashTodaysProfit: { bn: '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶æ‡¶≠', en: "Today's Profit" },
            dashTotalDue: { bn: '‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø (‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞)', en: 'Total Due (Customers)' }, dashTotalCustomers: { bn: '‡¶Æ‡ßã‡¶ü ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞', en: 'Total Customers' },
            dashTotalSuppliers: { bn: '‡¶Æ‡ßã‡¶ü ‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞', en: 'Total Suppliers' }, dashMonthlyExpense: { bn: '‡¶ö‡¶≤‡¶§‡¶ø ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ñ‡¶∞‡¶ö', en: 'Current Month Expense' },
            dashComputerIncome: { bn: '‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ', en: 'Computer Income' }, dashMobileFinanceBalance: { bn: '‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏', en: 'Mobile Finance Balance' },
            posHeader: { bn: '‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡¶´ ‡¶∏‡ßá‡¶≤ (POS)', en: 'Point of Sale (POS)' },
            posSearchPlaceholder: { bn: '‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...', en: 'Type product name...' }, posSavedCustomer: { bn: '‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞', en: 'Saved Customer' },
            posNewCustomer: { bn: '‡¶Ö‡¶•‡¶¨‡¶æ, ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ', en: 'Or, New Customer Name' }, posNewCustomerPlaceholder: { bn: '‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®', en: 'Enter new name' },
            posTblProduct: { bn: '‡¶™‡¶£‡ßç‡¶Ø', en: 'Product' }, posTblQty: { bn: '‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£', en: 'Quantity' },
            posTblPrice: { bn: '‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø', en: 'Price' }, posTblAction: { bn: '‡¶è‡¶ï‡¶∂‡¶®', en: 'Action' },
            posCartTotal: { bn: '‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø', en: 'Cart Total' }, posPreviousDue: { bn: '‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø', en: 'Previous Due' },
            posDiscount: { bn: '‡¶õ‡¶æ‡ßú', en: 'Discount' }, posPaidToday: { bn: '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶Æ‡¶æ', en: 'Paid Today' },
            posTotalDueFinal: { bn: '‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø', en: 'Total Due' }, posViewInvoiceBtn: { bn: '‡¶á‡¶®‡¶≠‡ßü‡ßá‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®', en: 'View Invoice' },
            posSaveBtn: { bn: '‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Save' }, posSavePrintBtn: { bn: '‡¶∏‡ßá‡¶≠ ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü', en: 'Save & Print' },
            posUpdateBtn: { bn: '‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Update' }, posUpdatePrintBtn: { bn: '‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü', en: 'Update & Print' },
            posSalesListHeader: { bn: 'POS ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ', en: 'POS Sales List' }, posSalesSearchPlaceholder: { bn: '‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...', en: 'Search by customer name...' },
            posSalesTblInvoice: { bn: '‡¶á‡¶®‡¶≠‡ßü‡ßá‡¶∏ ‡¶®‡¶Ç', en: 'Invoice No' }, posSalesTblDate: { bn: '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ', en: 'Date' },
            posSalesTblCustomer: { bn: '‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞', en: 'Customer' }, posSalesTblSeller: { bn: '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü‡¶ï‡¶æ‡¶∞‡ßÄ', en: 'Seller' },
            posSalesTblTotal: { bn: '‡¶Æ‡ßã‡¶ü', en: 'Total' }, posSalesTblDiscount: { bn: '‡¶õ‡¶æ‡ßú', en: 'Discount' }, 
            posSalesTblPaid: { bn: '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§', en: 'Paid' }, posSalesTblDue: { bn: '‡¶¨‡¶æ‡¶ï‡¶ø', en: 'Due' }, 
            posSalesTblAction: { bn: '‡¶è‡¶ï‡¶∂‡¶®', en: 'Action' },
            mobileFinanceHeader: {bn: '‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡¶æ‡¶á‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨', en: 'Mobile Finance Account'}, mfDateLabel: {bn: '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ', en: 'Date'},
            mfTypeLabel: {bn: '‡¶ß‡¶∞‡¶£', en: 'Type'}, mfServiceLabel: {bn: '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏', en: 'Service'}, mfAmountLabel: {bn: '‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£', en: 'Amount'},
            mfDescLabel: {bn: '‡¶¨‡¶ø‡¶¨‡¶∞‡¶£', en: 'Description'}, mfTblDate: {bn: '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ', en: 'Date'}, mfTblType: {bn: '‡¶ß‡¶∞‡¶£', en: 'Type'},
            mfTblService: {bn: '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏', en: 'Service'}, mfTblAmount: {bn: '‡¶ü‡¶æ‡¶ï‡¶æ', en: 'Amount'}, mfTblDesc: {bn: '‡¶¨‡¶ø‡¶¨‡¶∞‡¶£', en: 'Description'},
            unitsHeader: { bn: 'Unit ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü', en: 'Unit Management' }, unitNameLabel: { bn: 'Unit-‡¶è‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶Ø‡ßá‡¶Æ‡¶®: Kg, Pcs)', en: 'Unit Name (e.g., Kg, Pcs)' },
            unitDescLabel: { bn: '‡¶¨‡¶ø‡¶¨‡¶∞‡¶£', en: 'Description' }, saveUnitBtn: { bn: 'Unit ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Save Unit' },
            updateUnitBtn: { bn: 'Unit ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Update Unit' }, unitListHeader: { bn: 'Unit ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ', en: 'Unit List' },
            unitTblName: { bn: 'Unit-‡¶è‡¶∞ ‡¶®‡¶æ‡¶Æ', en: 'Unit Name' }, unitTblDesc: { bn: '‡¶¨‡¶ø‡¶¨‡¶∞‡¶£', en: 'Description' },
            unitTblAction: { bn: '‡¶è‡¶ï‡¶∂‡¶®', en: 'Action' }, productHeader: { bn: '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Add New Product' },
            productNameLabel: { bn: '‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ', en: 'Product Name' }, purchaseCostLabel: { bn: '‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø', en: 'Purchase Cost' },
            sellPriceLabel: { bn: '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø', en: 'Sell Price' }, unitLabel: { bn: 'Unit', en: 'Unit' },
            initialStockLabel: { bn: '‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶ï', en: 'Initial Stock' }, productImageLabel: { bn: '‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø', en: 'Product Image' },
            addProductBtn: { bn: '‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Add Product' }, updateProductBtn: { bn: '‡¶™‡¶£‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Update Product' },
            productTblImage: { bn: '‡¶õ‡¶¨‡¶ø', en: 'Image' }, productTblName: { bn: '‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ', en: 'Product Name' },
            productTblPurchaseCost: { bn: '‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø', en: 'Purchase Cost' }, productTblSellPrice: { bn: '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø', en: 'Sell Price' },
            productTblUnit: { bn: 'Unit', en: 'Unit' }, productTblStock: { bn: '‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶ï', en: 'Initial Stock' },
            productTblAction: { bn: '‡¶è‡¶ï‡¶∂‡¶®', en: 'Action' },
        };
        let currentLanguage = 'bn';

        let db = {
            credentials: { username: 'Admin', password: '1234' },
            shopInfo: { name: '‡¶∂‡¶´‡¶ø‡¶ï‡ßÅ‡¶≤ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ï‡¶∞‡ßç‡¶®‡¶æ‡¶∞', logo: null, address: '', mobile: '', proprietor: '', smsGatewayUrl: '' },
            products: [], customers: [], suppliers: [], sales: [], purchases: [],
            flexiloads: [], computerIncomes: [], shopExpenses: [], mobileFinances: [], flexiloadBalance: 0,
            users: [],
            units: [],
            categories: [],
            brands: [],
            templates: []
        };
        let editState = { key: null, id: null };
        let posCart = []; 
        let loggedInUser = null; 
        const placeholderImage = 'https://via.placeholder.com/150';
        
        let incomeExpenseChartInstance = null;
        let topProductsChartInstance = null;

        const setLanguage = (lang) => {
            currentLanguage = lang;
            localStorage.setItem('appLanguage', lang);
            document.documentElement.lang = lang;
            
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                if (translations[key] && translations[key][lang]) {
                    el.textContent = translations[key][lang];
                }
            });

            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                if (translations[key] && translations[key][lang]) {
                    el.placeholder = translations[key][lang];
                }
            });
        };

        const firebaseObjectToArray = (snapshot) => {
            const returnArr = [];
            if (snapshot.exists()) {
                snapshot.forEach(childSnapshot => {
                    let item = childSnapshot.val();
                    item.id = childSnapshot.key;
                    returnArr.push(item);
                });
            }
            return returnArr;
        };

        const init = () => { 
            const savedLang = localStorage.getItem('appLanguage') || 'bn';
            document.getElementById('language-selector').value = savedLang;
            setLanguage(savedLang);
            
            setupFirebaseListeners();
            attachEventListeners(); 
        };

        function setupFirebaseListeners() {
            database.ref('credentials').on('value', (snapshot) => {
                if (snapshot.exists()) { db.credentials = snapshot.val(); } 
                else { database.ref('credentials').set(db.credentials); }
            });

            database.ref('shopInfo').on('value', (snapshot) => {
                if (snapshot.exists()) { db.shopInfo = snapshot.val(); } 
                else { database.ref('shopInfo').set(db.shopInfo); }
                document.getElementById('shop-name-header').textContent = db.shopInfo.name; 
                setAppLogo(db.shopInfo.logo);
                const loginLogo = document.getElementById('login-page-logo');
                if (db.shopInfo.logo && loginLogo) loginLogo.src = db.shopInfo.logo;
            });

            const collections = ['products', 'customers', 'suppliers', 'sales', 'purchases', 'flexiloads', 'computerIncomes', 'shopExpenses', 'users', 'units', 'templates', 'mobileFinances', 'categories', 'brands'];
            collections.forEach(key => {
                database.ref(key).on('value', (snapshot) => {
                    db[key] = firebaseObjectToArray(snapshot);
                    const currentHash = window.location.hash || '#dashboard';
                    const activeSection = document.querySelector('.content-section.active');
                    if (activeSection && `#${activeSection.id}` === currentHash) {
                        navigateTo(currentHash);
                    }
                });
            });

             database.ref('flexiloadBalance').on('value', (snapshot) => {
                db.flexiloadBalance = snapshot.val() || 0;
                 if (window.location.hash === '#flexiload') {
                    const balanceEl = document.getElementById('flexiload-current-balance');
                    if(balanceEl) balanceEl.textContent = db.flexiloadBalance.toFixed(2);
                }
            });
        }
        
        function attachEventListeners() {
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            window.addEventListener('hashchange', () => navigateTo(window.location.hash));
            document.querySelector('.menu-toggle').addEventListener('click', () => document.querySelector('.app-nav').classList.toggle('active'));
            document.querySelectorAll('.nav-link').forEach(link => link.addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo(e.currentTarget.getAttribute('href'));
            }));
            document.getElementById('language-selector').addEventListener('change', (e) => setLanguage(e.target.value));

            const mainApp = document.getElementById('main-app');
            mainApp.addEventListener('submit', function(e) {
                const formHandlers = {
                    'product-form': handleProductSubmit, 'customer-form': handleCustomerSubmit, 'supplier-form': handleSupplierSubmit,
                    'sell-form': handleSellSubmit, 'purchase-form': handlePurchaseSubmit, 'computer-income-form': handleComputerIncomeSubmit,
                    'shop-expense-form': handleShopExpenseSubmit, 'report-form': handleReportGeneration, 'general-settings-form': handleSettingsSubmit,
                    'password-change-form': handlePasswordChange, 'flexiload-form': handleFlexiloadSubmit, 'flexiload-balance-form': handleAddFlexiloadBalance,
                    'user-form': handleUserSubmit, 'unit-form': handleUnitSubmit, 'template-form': handleSmsTemplateSubmit,
                    'mobile-finance-form': handleMobileFinanceSubmit,
                    'category-form': handleCategorySubmit,
                    'brand-form': handleBrandSubmit
                };
                if (formHandlers[e.target.id]) { e.preventDefault(); formHandlers[e.target.id](e); }
            });
            
             mainApp.addEventListener('click', function(e){
                const clickHandlers = {
                    'pos-view-btn': handlePosView, 'pos-save-btn': handlePosSave, 'pos-save-print-btn': handlePosSaveAndPrint,
                    'send-whatsapp-btn': handleSendWhatsApp, 'print-report-btn': printReport,
                };
                 if (clickHandlers[e.target.id]) { e.preventDefault(); clickHandlers[e.target.id](); }
                 
                 // ‚úÖ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßã‡¶õ‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
                 if (e.target.id === 'delete-all-data-btn') {
                    handleDeleteAllData();
                 }

                 if (e.target.classList.contains('dashboard-filter-btn')) {
                    const period = e.target.dataset.period;
                    document.querySelectorAll('.dashboard-filter-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    loadDashboardData(period);
                }
             });

            mainApp.addEventListener('change', function(e) {
                 if (e.target.id === 'logo-upload') handleLogoUpload(e);
                 if (e.target.id === 'product-image') handleProductImagePreview(e);
            });

            mainApp.addEventListener('input', function(e) {
                const calcSell = () => { const total = (parseFloat(document.getElementById('sell-price').value) || 0) * (parseInt(document.getElementById('sell-quantity').value) || 0); document.getElementById('sell-total').value = total.toFixed(2); document.getElementById('sell-due').value = (total - (parseFloat(document.getElementById('sell-paid').value) || 0)).toFixed(2); };
                const calcPur = () => { const total = (parseFloat(document.getElementById('purchase-price').value) || 0) * (parseInt(document.getElementById('purchase-quantity').value) || 0); document.getElementById('purchase-total').value = total.toFixed(2); document.getElementById('purchase-due').value = (total - (parseFloat(document.getElementById('purchase-paid').value) || 0)).toFixed(2); };

                if (['sell-quantity', 'sell-paid'].includes(e.target.id)) calcSell();
                if (['purchase-price', 'purchase-quantity', 'purchase-paid'].includes(e.target.id)) calcPur();
                if (e.target.id === 'sell-product-search') { const p = db.products.find(p => p.name === e.target.value); if(p) {document.getElementById('sell-price').value = p.sellPrice;} calcSell(); }
                if (e.target.id === 'purchase-product') { const p = db.products.find(prod => prod.name === e.target.value); if(p) {document.getElementById('purchase-price').value = p.purchaseCost;} calcPur(); }
                if (e.target.id === 'pos-paid' || e.target.id === 'pos-discount') renderPosCart();
                if (e.target.id === 'pos-customer-saved' || e.target.id === 'pos-customer-new') { 
                    if (e.target.id === 'pos-customer-new') {
                        const savedCustomerSelect = document.getElementById('pos-customer-saved');
                        if (savedCustomerSelect) savedCustomerSelect.value = '';
                    }
                    handleCustomerSelection(); 
                }
            });
        }
        
        const getTodayDate = () => new Date().toISOString().split('T')[0];
        const resetForm = (formEl, btnEl, textKey) => { if(formEl) formEl.reset(); if(btnEl && translations[textKey]){ btnEl.textContent = translations[textKey][currentLanguage]; btnEl.className = 'btn btn-primary'; btnEl.disabled = false;} editState = { key: null, id: null }; };
        const getProductStock = (productId) => { 
            const product = db.products.find(p => p.id === productId); 
            if (!product) return 0; 
            const purchased = db.purchases.filter(p => p.product === product.name).reduce((sum, p) => sum + p.quantity, 0); 
            const sold = db.sales.filter(s => s.product === product.name && !s.isPaymentRecord).reduce((sum, s) => sum + s.quantity, 0); 
            return (product.initialStock || 0) + purchased - sold; 
        };
        const handleLogin = (e) => {
            e.preventDefault();
            const usernameInput = document.getElementById('username').value.trim();
            const passwordInput = document.getElementById('password').value;
            const foundUser = db.users.find(user => 
                (user.name === usernameInput || user.email === usernameInput) && user.pass === passwordInput
            );

            if (foundUser) {
                loggedInUser = foundUser;
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('main-app').style.display = 'grid';
                document.getElementById('logged-in-user-display').textContent = `${translations.welcomeMsg[currentLanguage]} ${loggedInUser.name}`;
                setupUIForUserRole();
                navigateTo('#dashboard');
            } else {
                if (usernameInput === db.credentials.username && passwordInput === db.credentials.password) {
                     loggedInUser = { name: 'Super Admin', role: 'Admin' };
                     document.getElementById('login-page').style.display = 'none';
                     document.getElementById('main-app').style.display = 'grid';
                     document.getElementById('logged-in-user-display').textContent = `${translations.welcomeMsg[currentLanguage]} Super Admin`;
                     setupUIForUserRole();
                     navigateTo('#dashboard');
                } else {
                    document.getElementById('login-error').style.display = 'block';
                }
            }
        };
        const handleLogout = (e) => { if(e) e.preventDefault(); if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) { loggedInUser = null; window.location.reload(); } };
        const navigateTo = (hash) => {
            if (!hash) hash = '#dashboard';
            if(hash.startsWith('#')) { window.location.hash = hash; }
            document.querySelectorAll('.nav-link').forEach(l => l.classList.toggle('active', l.getAttribute('href') === hash));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            const activeSection = document.querySelector(hash);
            if(activeSection) activeSection.classList.add('active');
            const appNav = document.querySelector('.app-nav');
            if (appNav.classList.contains('active')) appNav.classList.remove('active');
            
            const pageLoaders = { '#dashboard': loadDashboardData, '#pos-system': loadPosPage, '#pos-sales-list': loadPosSalesListPage, '#sell': loadSellPage, '#purchase': loadPurchasePage, '#add-product': loadProductsPage, '#add-supplier': loadSuppliersPage, '#add-customer': loadCustomersPage, '#stock': loadStockPage, '#due-list': loadDueListPage, '#mobile-finance': loadMobileFinancePage, '#flexiload': loadFlexiloadPage, '#computer-income': loadComputerIncomePage, '#shop-account': loadShopExpensePage, '#report': ()=>document.getElementById('report-form').reset(), '#profile': loadProfilePage, '#settings': loadSettingsPage, '#user-management': loadUserManagementPage, '#units': loadUnitsPage, '#add-category': loadCategoryPage, '#add-brand': loadBrandPage, '#sms-sender': loadSmsSenderPage, '#sms-templates': loadSmsTemplatesPage };
            if (pageLoaders[hash]) {
                pageLoaders[hash]();
                setLanguage(currentLanguage);
            }
        };
        function setupUIForUserRole() {
            if (!loggedInUser) return;
            const role = loggedInUser.role;
            const rolePermissions = {
                'Admin': ['#dashboard', '#pos-system', '#pos-sales-list', '#sell', '#purchase', '#add-product', '#add-supplier', '#add-customer', '#stock', '#due-list', '#mobile-finance', '#flexiload', '#computer-income', '#shop-account', '#report', '#profile', '#settings', '#user-management', '#units', '#add-category', '#add-brand', '#sms-sender', '#sms-templates'],
                'Manager': ['#dashboard', '#pos-system', '#pos-sales-list', '#sell', '#purchase', '#add-product', '#add-supplier', '#add-customer', '#stock', '#due-list', '#mobile-finance', '#report', '#units', '#add-category', '#add-brand', '#sms-sender', '#sms-templates'],
                'Salesman': ['#dashboard', '#pos-system', '#pos-sales-list', '#sell', '#add-customer', '#stock', '#due-list', '#sms-sender']
            };
            const allowedLinks = rolePermissions[role] || [];
            document.querySelectorAll('.app-nav ul li a').forEach(link => {
                const href = link.getAttribute('href');
                link.parentElement.style.display = allowedLinks.includes(href) ? 'block' : 'none';
            });
        };
        window.editItem = (key, id) => {
            const item = db[key].find(i => i.id === id); if (!item) return;
            editState = { key, id };
            const prefix = (key === 'mobileFinances') ? 'mf' : (key === 'shopExpenses' ? 'se' : (key === 'computerIncomes' ? 'ci' : key.slice(0, -1)));
            const form = document.getElementById(`${prefix}-form`);
            const btn = document.getElementById(`${prefix}-submit-btn`);
            Object.keys(item).forEach(prop => {
                const input = form.querySelector(`#${prefix}-${prop}`);
                if (input && prop !== 'pass') input.value = item[prop];
            });
            if (key === 'users') { const passInput = form.querySelector('#user-pass'); if(passInput) { passInput.value = ''; passInput.placeholder = '‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶® (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)'; passInput.required = false; } }
            if (key === 'products') {
                 document.getElementById('product-image-preview').src = item.image || placeholderImage; 
                 document.getElementById('product-unit').value = item.unit || ''; 
                 document.getElementById('product-category').value = item.category || ''; 
                 document.getElementById('product-brand').value = item.brand || '';
            }
            if (btn) { const updateKey = `update${prefix.charAt(0).toUpperCase() + prefix.slice(1)}Btn`; const updateText = translations[updateKey]?.[currentLanguage] || translations.updateBtn[currentLanguage]; btn.textContent = updateText; btn.className = 'btn btn-warning'; }
            form.scrollIntoView({ behavior: 'smooth' });
        };
        window.deleteItem = (key, id) => { if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) { database.ref(key).child(id).remove().then(() => alert('‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§')).catch((error) => alert('‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá: ' + error.message)); } };
        function handleProductImagePreview(e) { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (event) => { document.getElementById('product-image-preview').src = event.target.result; }; reader.readAsDataURL(file); } };
        
        function loadProductsPage() { 
            const populateSelect = (selectId, data, nameKey = 'name') => {
                const selectEl = document.getElementById(selectId);
                selectEl.innerHTML = `<option value="">-- ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® --</option>`;
                data.forEach(item => selectEl.innerHTML += `<option value="${item[nameKey]}">${item[nameKey]}</option>`);
            };

            populateSelect('product-unit', db.units);
            populateSelect('product-category', db.categories);
            populateSelect('product-brand', db.brands);
            
            const tBody = document.querySelector('#product-table tbody'); tBody.innerHTML = ''; 
            db.products.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).forEach((p) => { 
                tBody.innerHTML += `<tr>
                    <td data-label="‡¶õ‡¶¨‡¶ø"><img src="${p.image || placeholderImage}" alt="${p.name}" class="table-product-image"></td>
                    <td data-label="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">${p.name}</td>
                    <td data-label="‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø">${p.category || ''}</td>
                    <td data-label="‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶°">${p.brand || ''}</td>
                    <td data-label="‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">${(p.purchaseCost || 0).toFixed(2)}</td>
                    <td data-label="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">${(p.sellPrice || 0).toFixed(2)}</td>
                    <td data-label="Unit">${p.unit || 'N/A'}</td>
                    <td data-label="‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶ï">${p.initialStock || 0}</td>
                    <td data-label="‡¶è‡¶ï‡¶∂‡¶®">
                        <button class="action-btn edit-btn" onclick="editItem('products', '${p.id}')">${translations.editBtn[currentLanguage]}</button>
                        <button class="action-btn delete-btn" onclick="deleteItem('products', '${p.id}')">${translations.deleteBtn[currentLanguage]}</button>
                    </td>
                </tr>`; 
            }); 
            resetForm(document.getElementById('product-form'), document.getElementById('product-submit-btn'), 'addProductBtn'); 
            document.getElementById('product-stock').value = 0; document.getElementById('product-image-preview').src = placeholderImage;
        }

        function handleProductSubmit(e) {
            e.preventDefault(); const btn = document.getElementById('product-submit-btn'); btn.textContent = '‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...'; btn.disabled = true;
            const saveProductData = (imageUrl) => {
                const productData = { 
                    name: document.getElementById('product-name').value.trim(),
                    category: document.getElementById('product-category').value,
                    brand: document.getElementById('product-brand').value,
                    purchaseCost: parseFloat(document.getElementById('product-purchase-cost').value) || 0,
                    sellPrice: parseFloat(document.getElementById('product-sell-price').value) || 0,
                    initialStock: parseInt(document.getElementById('product-stock').value) || 0,
                    unit: document.getElementById('product-unit').value,
                    image: imageUrl !== undefined ? imageUrl : (editState.id ? (db.products.find(p => p.id === editState.id).image || null) : null),
                    timestamp: firebase.database.ServerValue.TIMESTAMP 
                };
                const promise = editState.id ? database.ref('products').child(editState.id).update(productData) : database.ref('products').push(productData);
                promise.then(() => { alert('‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }).catch(err => { alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message); btn.disabled = false; });
            };
            const imageFile = document.getElementById('product-image').files[0];
            if (imageFile) {
                const apiKey = '07a9c70579b89377dc931ef0fb35e0f4'; const formData = new FormData(); formData.append('image', imageFile);
                fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, { method: 'POST', body: formData }).then(response => response.json())
                .then(result => { if (result.success) saveProductData(result.data.url); else throw new Error(result.error.message); })
                .catch(error => { alert('‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + error.message); btn.disabled = false; });
            } else saveProductData(undefined);
        }
        
        function loadCustomersPage() { const tBody = document.querySelector('#customer-table tbody'); tBody.innerHTML = ''; db.customers.forEach((c, i) => { tBody.innerHTML += `<tr><td data-label="‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤">${i+1}</td><td data-label="‡¶®‡¶æ‡¶Æ">${c.name}</td><td data-label="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤">${c.mobile}</td><td data-label="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">${c.address || ''}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn edit-btn" onclick="editItem('customers', '${c.id}')">${translations.editBtn[currentLanguage]}</button><button class="action-btn delete-btn" onclick="deleteItem('customers', '${c.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); document.getElementById('customer-sl').value = db.customers.length + 1; resetForm(document.getElementById('customer-form'), document.getElementById('customer-submit-btn'), 'saveBtn'); }
        function handleCustomerSubmit(e) { e.preventDefault(); const btn = document.getElementById('customer-submit-btn'); btn.disabled = true; const newData = { name: document.getElementById('customer-name').value.trim(), mobile: document.getElementById('customer-mobile').value, address: document.getElementById('customer-address').value }; if (editState.key === 'customers') { database.ref('customers').child(editState.id).update(newData).then(() => {alert('‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!');}); } else { database.ref('customers').push(newData).then(()=>{alert('‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!');}); } }
        function loadSuppliersPage() { const tBody = document.querySelector('#supplier-table tbody'); tBody.innerHTML = ''; db.suppliers.forEach((s, i) => { tBody.innerHTML += `<tr><td data-label="‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤">${i+1}</td><td data-label="‡¶®‡¶æ‡¶Æ">${s.name}</td><td data-label="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤">${s.mobile}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn edit-btn" onclick="editItem('suppliers', '${s.id}')">${translations.editBtn[currentLanguage]}</button><button class="action-btn delete-btn" onclick="deleteItem('suppliers', '${s.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); document.getElementById('supplier-sl').value = db.suppliers.length + 1; resetForm(document.getElementById('supplier-form'), document.getElementById('supplier-submit-btn'), 'saveBtn'); }
        function handleSupplierSubmit(e) { e.preventDefault(); const btn = document.getElementById('supplier-submit-btn'); btn.disabled = true; const newData = { name: document.getElementById('supplier-name').value.trim(), mobile: document.getElementById('supplier-mobile').value }; if (editState.key === 'suppliers') { database.ref('suppliers').child(editState.id).update(newData).then(()=>{alert('‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!');}); } else { database.ref('suppliers').push(newData).then(()=>{alert('‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!');}); } }
        function loadSellPage() { document.getElementById('sell-date').value = getTodayDate(); const customerSelect = document.getElementById('sell-customer'); customerSelect.innerHTML = '<option value="">‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü</option>'; db.customers.forEach(c => customerSelect.innerHTML += `<option value="${c.name}">${c.name}</option>`); const productDatalist = document.getElementById('product-list'); productDatalist.innerHTML = ''; db.products.forEach(p => productDatalist.innerHTML += `<option value="${p.name}">`); const tBody = document.querySelector('#sell-table tbody'); tBody.innerHTML = ''; db.sales.filter(s => !s.isPosSale).sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).forEach((s) => { tBody.innerHTML += `<tr><td data-label="‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">${s.date}</td><td data-label="‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞">${s.customer}</td><td data-label="‡¶™‡¶£‡ßç‡¶Ø">${s.product}</td><td data-label="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">${s.quantity}</td><td data-label="‡¶Æ‡ßã‡¶ü">${s.total.toFixed(2)}</td><td data-label="‡¶ú‡¶Æ‡¶æ">${s.paid.toFixed(2)}</td><td data-label="‡¶¨‡¶æ‡¶ï‡¶ø">${s.due.toFixed(2)}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn delete-btn" onclick="deleteItem('sales', '${s.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('sell-form'), document.getElementById('sell-submit-btn'), 'saveBtn'); document.getElementById('sell-date').value = getTodayDate(); }
        function handleSellSubmit(e) { e.preventDefault(); const productName = document.getElementById('sell-product-search').value; const quantityToSell = parseInt(document.getElementById('sell-quantity').value); const product = db.products.find(p => p.name === productName); if (!product) { alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶è‡¶á ‡¶™‡¶£‡ßç‡¶Ø‡¶ü‡¶ø ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡ßü ‡¶®‡ßá‡¶á!'); return; } const stock = getProductStock(product.id); if(quantityToSell > stock){ alert(`‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶è‡¶á ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡¶ï ‡¶®‡ßá‡¶á‡•§\n‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï: ${stock}`); return; } const btn = document.getElementById('sell-submit-btn'); btn.disabled = true; const newData = { date: document.getElementById('sell-date').value, customer: document.getElementById('sell-customer').value, product: productName, quantity: quantityToSell, total: parseFloat(document.getElementById('sell-total').value), paid: parseFloat(document.getElementById('sell-paid').value), due: parseFloat(document.getElementById('sell-due').value), isPosSale: false, timestamp: firebase.database.ServerValue.TIMESTAMP }; database.ref('sales').push(newData).then(() => { alert('‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }); }
        function loadPurchasePage() { document.getElementById('purchase-date').value = getTodayDate(); const supplierSelect = document.getElementById('purchase-supplier'); supplierSelect.innerHTML = '<option value="">‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü</option>'; db.suppliers.forEach(s => supplierSelect.innerHTML += `<option value="${s.name}">${s.name}</option>`); const productSelect = document.getElementById('purchase-product'); productSelect.innerHTML = '<option value="">‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü</option>'; db.products.forEach(p => productSelect.innerHTML += `<option value="${p.name}">${p.name}</option>`); const tBody = document.querySelector('#purchase-table tbody'); tBody.innerHTML = ''; db.purchases.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).forEach((p) => { tBody.innerHTML += `<tr><td data-label="‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">${p.date}</td><td data-label="‡¶∏‡¶æ‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞">${p.supplier}</td><td data-label="‡¶™‡¶£‡ßç‡¶Ø">${p.product}</td><td data-label="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">${p.quantity}</td><td data-label="‡¶Æ‡ßã‡¶ü">${p.total.toFixed(2)}</td><td data-label="‡¶ú‡¶Æ‡¶æ">${p.paid.toFixed(2)}</td><td data-label="‡¶¨‡¶æ‡¶ï‡¶ø">${p.due.toFixed(2)}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn edit-btn" onclick="editItem('purchases', '${p.id}')">${translations.editBtn[currentLanguage]}</button><button class="action-btn delete-btn" onclick="deleteItem('purchases', '${p.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('purchase-form'), document.getElementById('purchase-submit-btn'), 'saveBtn'); document.getElementById('purchase-date').value = getTodayDate(); }
        function handlePurchaseSubmit(e) { e.preventDefault(); const btn = document.getElementById('purchase-submit-btn'); btn.disabled = true; const newData = { date: document.getElementById('purchase-date').value, supplier: document.getElementById('purchase-supplier').value, product: document.getElementById('purchase-product').value, quantity: parseInt(document.getElementById('purchase-quantity').value), price: parseFloat(document.getElementById('purchase-price').value), total: parseFloat(document.getElementById('purchase-total').value), paid: parseFloat(document.getElementById('purchase-paid').value), due: parseFloat(document.getElementById('purchase-due').value), timestamp: firebase.database.ServerValue.TIMESTAMP }; if(editState.key === 'purchases') { database.ref('purchases').child(editState.id).update(newData).then(() => { alert('‡¶ï‡ßç‡¶∞‡ßü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }); } else { database.ref('purchases').push(newData).then(() => { alert('‡¶ï‡ßç‡¶∞‡ßü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }); } }
        function loadStockPage(){ const tBody = document.querySelector('#stock-table tbody'); tBody.innerHTML = ''; db.products.forEach(product => { const currentStock = getProductStock(product.id); const purchased = db.purchases.filter(p => p.product === product.name).reduce((sum, p) => sum + p.quantity, 0); const sold = db.sales.filter(s => s.product === product.name && !s.isPaymentRecord).reduce((sum, s) => sum + s.quantity, 0); tBody.innerHTML += `<tr><td data-label="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">${product.name}</td><td data-label="‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡¶ï">${product.initialStock || 0}</td><td data-label="‡¶Æ‡ßã‡¶ü ‡¶ï‡ßç‡¶∞‡ßü">${purchased}</td><td data-label="‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü">${sold}</td><td data-label="‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡¶ï">${currentStock}</td></tr>`; }); }
        function loadDueListPage() {
            const tBody = document.querySelector('#due-list-table tbody'); tBody.innerHTML = '';
            const customerDues = {};
            db.customers.forEach(customer => {
                const totalDueForCustomer = db.sales.filter(s => s.customer === customer.name && s.isPaymentRecord).reduce((sum, sale) => sum + sale.due, 0);
                if (totalDueForCustomer > 0.01) customerDues[customer.name] = { due: totalDueForCustomer, id: customer.id };
            });
            let serial = 1;
            for (const customerName in customerDues) {
                const customerId = customerDues[customerName].id;
                tBody.innerHTML += `<tr><td data-label="‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤">${serial}</td><td data-label="‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">${customerName}</td><td data-label="‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶ï‡¶ø">${customerDues[customerName].due.toFixed(2)}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn btn-info" onclick="collectDue('${customerName}')">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ</button><button class="action-btn btn-success" onclick="sendDueReminderSms('${customerId}')" ${!customerId ? 'disabled' : ''}>SMS ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button></td></tr>`;
                serial++;
            }
        }
        window.collectDue = (customerName) => {
            const currentDue = db.sales.filter(s => s.isPaymentRecord && s.customer === customerName).reduce((total, sale) => total + sale.due, 0);
            const paymentAmountStr = prompt(`"${customerName}" ‡¶è‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶®‡¶ø‡¶ö‡ßç‡¶õ‡ßá‡¶®?\n‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡¶æ‡¶ï‡¶ø: ${currentDue.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`, "0");
            if (paymentAmountStr === null) return;
            const paymentAmount = parseFloat(paymentAmountStr);
            if (isNaN(paymentAmount) || paymentAmount <= 0) { alert("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§"); return; }
            const paymentRecord = { date: getTodayDate(), customer: customerName, product: '‡¶¨‡¶æ‡¶ï‡¶ø ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ', quantity: 1, total: 0, discount: 0, paid: paymentAmount, due: -paymentAmount, isPosSale: true, isPaymentRecord: true, timestamp: firebase.database.ServerValue.TIMESTAMP };
            database.ref('sales').push(paymentRecord).then(() => alert(`‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${paymentAmount.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`));
        };
        window.deleteFlexiload = (id) => { if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶ì ‡¶ï‡¶Æ‡¶ø‡¶∂‡¶®‡ßá‡¶∞ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶´‡ßá‡¶∞‡¶§ ‡¶Ü‡¶∏‡¶¨‡ßá‡•§')) { const item = db.flexiloads.find(f=>f.id === id); if(item) { const newBalance = db.flexiloadBalance + item.amount - item.commission; database.ref('flexiloadBalance').set(newBalance); database.ref('flexiloads').child(id).remove(); } } };
        function handleAddFlexiloadBalance(e) { e.preventDefault(); const amountToAdd = parseFloat(document.getElementById('flexiload-add-balance-amount').value); if(isNaN(amountToAdd) || amountToAdd <= 0) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§'); return; } database.ref('flexiloadBalance').set(db.flexiloadBalance + amountToAdd).then(() => { alert(`‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${amountToAdd.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`); document.getElementById('flexiload-balance-form').reset(); }); }
        function loadFlexiloadPage() { document.getElementById('flexiload-current-balance').textContent = db.flexiloadBalance.toFixed(2); const tBody = document.querySelector('#flexiload-table tbody'); tBody.innerHTML = ''; db.flexiloads.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).forEach((item, i) => { tBody.innerHTML += `<tr><td data-label="‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤">${i+1}</td><td data-label="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤">${item.mobile}</td><td data-label="‡¶ü‡¶æ‡¶ï‡¶æ">${item.amount.toFixed(2)}</td><td data-label="‡¶ï‡¶Æ‡¶ø‡¶∂‡¶®">${(item.commission || 0).toFixed(2)}</td><td data-label="‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏">${item.status}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn delete-btn" onclick="deleteFlexiload('${item.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('flexiload-form'), document.getElementById('flexiload-submit-btn'), 'saveBtn'); }
        function handleFlexiloadSubmit(e) { e.preventDefault(); const amount = parseFloat(document.getElementById('flexiload-amount').value); const commission = parseFloat(document.getElementById('flexiload-commission').value) || 0; const status = document.getElementById('flexiload-status').value; if (status === 'Success' && db.flexiloadBalance < amount) { alert(`‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡ßü‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (${db.flexiloadBalance.toFixed(2)}) ‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§‡•§`); return; } const btn = document.getElementById('flexiload-submit-btn'); btn.disabled = true; const newData = { mobile: document.getElementById('flexiload-mobile').value, amount: amount, commission: commission, status: status, timestamp: firebase.database.ServerValue.TIMESTAMP }; database.ref('flexiloads').push(newData).then(() => { if (status === 'Success') { database.ref('flexiloadBalance').set(db.flexiloadBalance - amount + commission); } }); }
        function loadComputerIncomePage() { const tBody = document.querySelector('#ci-table tbody'); tBody.innerHTML = ''; db.computerIncomes.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).forEach((item) => { tBody.innerHTML += `<tr><td data-label="‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">${item.date}</td><td data-label="‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">${item.work}</td><td data-label="‡¶ü‡¶æ‡¶ï‡¶æ">${item.amount.toFixed(2)}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn delete-btn" onclick="deleteItem('computerIncomes', '${item.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('computer-income-form'), document.getElementById('ci-submit-btn'), 'saveBtn'); document.getElementById('ci-date').value = getTodayDate(); }
        function handleComputerIncomeSubmit(e) { e.preventDefault(); const btn = document.getElementById('ci-submit-btn'); btn.disabled = true; const newData = { date: document.getElementById('ci-date').value, work: document.getElementById('ci-work-name').value, amount: parseFloat(document.getElementById('ci-amount').value), timestamp: firebase.database.ServerValue.TIMESTAMP }; database.ref('computerIncomes').push(newData).then(() => { document.getElementById('computer-income-form').reset(); document.getElementById('ci-date').value = getTodayDate(); }); }
        function loadShopExpensePage() { const tBody = document.querySelector('#se-table tbody'); tBody.innerHTML = ''; db.shopExpenses.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).forEach((item, i) => { tBody.innerHTML += `<tr><td data-label="‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤">${i + 1}</td><td data-label="‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">${item.date}</td><td data-label="‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ß‡¶∞‡¶£">${item.type}</td><td data-label="‡¶ü‡¶æ‡¶ï‡¶æ">${item.amount.toFixed(2)}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn delete-btn" onclick="deleteItem('shopExpenses', '${item.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('shop-expense-form'), document.getElementById('se-submit-btn'), 'saveBtn'); }
        function handleShopExpenseSubmit(e) { e.preventDefault(); const btn = document.getElementById('se-submit-btn'); btn.disabled = true; const newData = { date: document.getElementById('se-date').value, type: document.getElementById('se-type').value, amount: parseFloat(document.getElementById('se-amount').value), timestamp: firebase.database.ServerValue.TIMESTAMP }; database.ref('shopExpenses').push(newData).then(() => { document.getElementById('shop-expense-form').reset(); }); }
        
        function loadMobileFinancePage() {
            const tBody = document.querySelector('#mobile-finance-table tbody');
            tBody.innerHTML = '';
            db.mobileFinances.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0)).forEach(item => {
                tBody.innerHTML += `<tr>
                    <td data-label="‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">${item.date}</td>
                    <td data-label="‡¶ß‡¶∞‡¶£">${item.type}</td>
                    <td data-label="‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏">${item.service}</td>
                    <td data-label="‡¶ü‡¶æ‡¶ï‡¶æ">${item.amount.toFixed(2)}</td>
                    <td data-label="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£">${item.description || ''}</td>
                    <td data-label="‡¶è‡¶ï‡¶∂‡¶®">
                        <button class="action-btn edit-btn" onclick="editItem('mobileFinances', '${item.id}')">${translations.editBtn[currentLanguage]}</button>
                        <button class="action-btn delete-btn" onclick="deleteItem('mobileFinances', '${item.id}')">${translations.deleteBtn[currentLanguage]}</button>
                    </td>
                </tr>`;
            });
            resetForm(document.getElementById('mobile-finance-form'), document.getElementById('mf-submit-btn'), 'saveBtn');
            document.getElementById('mf-date').value = getTodayDate();
        }

        function handleMobileFinanceSubmit(e) {
            e.preventDefault();
            const btn = document.getElementById('mf-submit-btn');
            btn.disabled = true;
            const newData = {
                date: document.getElementById('mf-date').value,
                type: document.getElementById('mf-type').value,
                service: document.getElementById('mf-service').value,
                amount: parseFloat(document.getElementById('mf-amount').value),
                description: document.getElementById('mf-description').value.trim(),
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            let promise;
            if (editState.key === 'mobileFinances') {
                promise = database.ref('mobileFinances').child(editState.id).update(newData);
            } else {
                promise = database.ref('mobileFinances').push(newData);
            }

            promise.then(() => {
                alert('‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            }).catch(err => {
                alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message);
                btn.disabled = false;
            });
        }

        window.filterAndDisplayPosProducts = () => {
            const categoryFilter = document.getElementById('pos-category-filter').value;
            const brandFilter = document.getElementById('pos-brand-filter').value;
            let filteredProducts = db.products;
            if (categoryFilter) { filteredProducts = filteredProducts.filter(p => p.category === categoryFilter); }
            if (brandFilter) { filteredProducts = filteredProducts.filter(p => p.brand === brandFilter); }
            const grid = document.getElementById('pos-product-grid'); grid.innerHTML = '';
            if (filteredProducts.length === 0) { grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #888;">‡¶è‡¶á ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶£‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>'; return; }
            filteredProducts.forEach(p => { const stock = getProductStock(p.id); const isOutOfStock = stock <= 0; grid.innerHTML += `<div class="pos-product-btn" onclick="${isOutOfStock ? "alert('‡¶è‡¶á ‡¶™‡¶£‡ßç‡¶Ø‡¶ü‡¶ø ‡¶∏‡ßç‡¶ü‡¶ï ‡¶Ü‡¶â‡¶ü!')" : `addToPosCart('${p.id}')`}" style="${isOutOfStock ? 'opacity: 0.5; cursor: not-allowed;' : ''}"><img src="${p.image || placeholderImage}" alt="${p.name}"><h4>${p.name}</h4><p>${(p.sellPrice || 0).toFixed(2)}</p><span style="font-size: 11px; font-weight: bold; color: ${isOutOfStock ? 'var(--danger-color)' : 'var(--success-color)'};">‡¶∏‡ßç‡¶ü‡¶ï: ${stock}</span></div>`; });
        }
        
        function loadPosPage() {
            editState = { key: null, id: null };
            const categorySelect = document.getElementById('pos-category-filter'); categorySelect.innerHTML = '<option value="">‡¶∏‡¶ï‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option>'; db.categories.forEach(cat => { categorySelect.innerHTML += `<option value="${cat.name}">${cat.name}</option>`; });
            const brandSelect = document.getElementById('pos-brand-filter'); brandSelect.innerHTML = '<option value="">‡¶∏‡¶ï‡¶≤ ‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶°</option>'; db.brands.forEach(br => { brandSelect.innerHTML += `<option value="${br.name}">${br.name}</option>`; });
            const customerSelect = document.getElementById('pos-customer-saved'); customerSelect.innerHTML = `<option value="">-- ${currentLanguage === 'bn' ? '‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü' : 'Select Customer'} --</option>`; db.customers.forEach(c => { customerSelect.innerHTML += `<option value="${c.name}">${c.name}</option>`; });
            filterAndDisplayPosProducts();
            document.getElementById('pos-checkout-form').reset(); posCart = []; handleCustomerSelection();
            document.getElementById('pos-save-btn').textContent = translations.posSaveBtn[currentLanguage]; document.getElementById('pos-save-print-btn').textContent = translations.posSavePrintBtn[currentLanguage];
        }

        function loadPosSalesListPage() {
            const tBody = document.querySelector('#pos-sales-table tbody'); tBody.innerHTML = ''; 
            const posSales = db.sales.filter(s => s.isPosSale && s.isPaymentRecord).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)); 
            posSales.forEach(sale => { 
                tBody.innerHTML += `<tr>
                    <td data-label="‡¶á‡¶®‡¶≠‡ßü‡ßá‡¶∏ ‡¶®‡¶Ç">${sale.invoiceId.slice(-6)}</td>
                    <td data-label="‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">${sale.date}</td>
                    <td data-label="‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞">${sale.customer}</td>
                    <td data-label="‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü‡¶ï‡¶æ‡¶∞‡ßÄ">${sale.sellerName || 'N/A'}</td>
                    <td data-label="‡¶Æ‡ßã‡¶ü">${sale.total.toFixed(2)}</td>
                    <td data-label="‡¶õ‡¶æ‡ßú">${(sale.discount || 0).toFixed(2)}</td>
                    <td data-label="‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§">${sale.paid.toFixed(2)}</td>
                    <td data-label="‡¶¨‡¶æ‡¶ï‡¶ø">${sale.due.toFixed(2)}</td>
                    <td data-label="‡¶è‡¶ï‡¶∂‡¶®">
                        <button class="action-btn btn-info" onclick="reprintInvoice('${sale.invoiceId}')">${translations.printBtn[currentLanguage]}</button>
                        <button class="action-btn edit-btn" onclick="editPosSale('${sale.invoiceId}')">${translations.editBtn[currentLanguage]}</button>
                        <button class="action-btn delete-btn" onclick="deletePosSale('${sale.invoiceId}')">${translations.deleteBtn[currentLanguage]}</button>
                    </td>
                </tr>`; 
            }); 
        }
        window.deletePosSale = (invoiceId) => { if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶∏‡¶ï‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) { const updates = {}; db.sales.forEach(sale => { if (sale.invoiceId === invoiceId) { updates[sale.id] = null; } }); database.ref('sales').update(updates).then(() => alert('‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§')).catch(err => alert('‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message)); } };
        window.editPosSale = (invoiceId) => {
            const masterSale = db.sales.find(s => s.invoiceId === invoiceId && s.isPaymentRecord); if (!masterSale) { alert("‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!"); return; }
            editState = { key: 'posSale', id: invoiceId };
            const saleItems = db.sales.filter(s => s.invoiceId === invoiceId && !s.isPaymentRecord);
            posCart = saleItems.map(item => { const product = db.products.find(p => p.name === item.product); return { id: product ? product.id : 0, name: item.product, price: item.price || (item.total/item.quantity), quantity: item.quantity, total: item.total, unit: product ? product.unit : '' }; });
            navigateTo('#pos-system');
            setTimeout(() => {
                const savedCustomer = db.customers.find(c => c.name === masterSale.customer);
                if (savedCustomer) { document.getElementById('pos-customer-saved').value = masterSale.customer; } else { document.getElementById('pos-customer-new').value = masterSale.customer; }
                document.getElementById('pos-discount').value = masterSale.discount || 0; document.getElementById('pos-paid').value = masterSale.paid || 0;
                handleCustomerSelection();
                document.getElementById('pos-save-btn').textContent = translations.posUpdateBtn[currentLanguage];
                document.getElementById('pos-save-print-btn').textContent = translations.posUpdatePrintBtn[currentLanguage];
                document.getElementById('pos-save-btn').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        };
        function getCustomerDue(customerName) { if (!customerName) return 0; return db.sales.filter(s => s.isPaymentRecord && s.customer === customerName && s.invoiceId !== editState.id).reduce((total, sale) => total + sale.due, 0); }
        function handleCustomerSelection() { const customerName = document.getElementById('pos-customer-saved').value || document.getElementById('pos-customer-new').value.trim(); const previousDue = getCustomerDue(customerName); document.getElementById('pos-previous-due').value = previousDue.toFixed(2); renderPosCart(); }
        window.addToPosCart = (productId) => { 
            const product = db.products.find(p => p.id === productId); 
            if(!product) return; 
            const stock = getProductStock(productId); 
            const itemInCart = posCart.find(item => item.id === productId); 
            const qtyInCart = itemInCart ? itemInCart.quantity : 0; 
            if (stock <= qtyInCart) { alert('‡¶è‡¶á ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶Ü‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶®‡ßá‡¶á!'); return; } 
            if (itemInCart) { itemInCart.quantity++; } 
            else { posCart.push({ id: product.id, name: product.name, price: product.sellPrice, quantity: 1, unit: product.unit }); } 
            renderPosCart(); 
        };
        window.updatePosCartQuantity = (index, newQty) => { const item = posCart[index]; const stock = getProductStock(item.id); if(newQty > stock) { alert(`‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶∏‡ßç‡¶ü‡¶ï ${stock}‡¶ü‡¶ø`); renderPosCart(); return; } if (newQty <= 0) { posCart.splice(index, 1); } else { item.quantity = parseInt(newQty); } renderPosCart(); };
        window.removeFromPosCart = (index) => { posCart.splice(index, 1); renderPosCart(); };
        function renderPosCart() {
            const cartBody = document.querySelector('#pos-cart-table tbody'); cartBody.innerHTML = ''; let total = 0;
            posCart.forEach((item, index) => { 
                const subtotal = item.price * item.quantity; 
                item.total = subtotal; 
                total += subtotal; 
                cartBody.innerHTML += `<tr>
                    <td data-label="‡¶™‡¶£‡ßç‡¶Ø">${item.name}</td>
                    <td data-label="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
                        <input type="number" value="${item.quantity}" min="1" onchange="updatePosCartQuantity(${index}, this.value)" style="width: 60px; margin-right: 5px;"> 
                        ${item.unit || ''}
                    </td>
                    <td data-label="‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø">${subtotal.toFixed(2)}</td>
                    <td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn delete-btn" onclick="removeFromPosCart(${index})">X</button></td>
                </tr>`; 
            });
            const previousDue = parseFloat(document.getElementById('pos-previous-due').value) || 0; const discount = parseFloat(document.getElementById('pos-discount').value) || 0; const paid = parseFloat(document.getElementById('pos-paid').value) || 0;
            document.getElementById('pos-total').value = total.toFixed(2); document.getElementById('pos-due').value = (previousDue + total - discount - paid).toFixed(2);
        }
        function processPosSale(shouldPrint = false) {
            if (posCart.length === 0) { alert('‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); return; }
            let customerName = document.getElementById('pos-customer-new').value.trim() || document.getElementById('pos-customer-saved').value || "‡¶®‡¶ó‡¶¶ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞";
            const total = parseFloat(document.getElementById('pos-total').value); const discount = parseFloat(document.getElementById('pos-discount').value) || 0;
            const paid = parseFloat(document.getElementById('pos-paid').value); const due = parseFloat(document.getElementById('pos-due').value);
            const invoiceId = (editState.key === 'posSale' && editState.id) ? editState.id : database.ref().push().key;
            const saveNewSale = () => {
                const updates = {};
                posCart.forEach(item => { const newItemKey = database.ref('sales').push().key; updates[`/sales/${newItemKey}`] = { invoiceId, product: item.name, price: item.price, quantity: item.quantity, unit: item.unit, total: item.total, isPosSale: true, isPaymentRecord: false }; });
                const masterKey = database.ref('sales').push().key;
                updates[`/sales/${masterKey}`] = { invoiceId, date: getTodayDate(), customer: customerName, sellerName: loggedInUser.name, product: 'POS Sale', quantity: 1, total, discount, paid, due, isPosSale: true, isPaymentRecord: true, timestamp: firebase.database.ServerValue.TIMESTAMP };
                database.ref().update(updates).then(() => {
                    const action = (editState.key === 'posSale') ? '‡¶Ü‡¶™‡¶°‡ßá‡¶ü' : '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü'; alert(`${action} ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
                    if (shouldPrint) { const html = generateInvoiceHtml(customerName, invoiceId, total, discount, paid, due, posCart); printInvoice(html); }
                    navigateTo('#pos-system');
                }).catch(err => alert('‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message));
            }
            if(editState.key === 'posSale' && editState.id){
                const oldSalesPromises = db.sales.filter(sale => sale.invoiceId === editState.id).map(sale => database.ref('sales').child(sale.id).remove());
                Promise.all(oldSalesPromises).then(saveNewSale).catch(err => alert('‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message));
            } else saveNewSale();
        }
        function handlePosSaveAndPrint() { processPosSale(true); }
        function handlePosSave() { processPosSale(false); }
        function handlePosView() {
            if (posCart.length === 0) { alert('‡¶á‡¶®‡¶≠‡ßü‡ßá‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßá ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); return; }
            let customerName = document.getElementById('pos-customer-new').value.trim() || document.getElementById('pos-customer-saved').value || "‡¶®‡¶ó‡¶¶ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞";
            const total = parseFloat(document.getElementById('pos-total').value); const discount = parseFloat(document.getElementById('pos-discount').value) || 0;
            const paid = parseFloat(document.getElementById('pos-paid').value); const due = parseFloat(document.getElementById('pos-due').value);
            const htmlContent = generateInvoiceHtml(customerName, 'PREVIEW-123', total, discount, paid, due, posCart);
            const previewWindow = window.open('', '_blank'); previewWindow.document.write(htmlContent); previewWindow.document.close();
        }
        
        function generateInvoiceHtml(customer, invoiceId, total, discount, paid, due, items, dateStr) {
            let itemsHtml = ''; let sl = 1;
            items.forEach(item => { const price = item.price || (item.total / item.quantity); const itemTotal = price * item.quantity; itemsHtml += `<tr><td>${sl++}</td><td>${item.name || item.product}</td><td>${price.toFixed(2)}</td><td>${item.quantity} ${item.unit || ''}</td><td>${itemTotal.toFixed(2)}</td></tr>`; });
            const previousDue = getCustomerDue(customer); const grandTotal = previousDue + total; const finalDue = grandTotal - discount - paid; 
            const displayDate = dateStr || new Date().toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' });
            return `
            <!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Invoice - ${invoiceId.slice(-6)}</title>
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Tiro+Bangla&display=swap');
                body { font-family: 'Poppins', 'Tiro Bangla', sans-serif; margin: 0; padding: 0; background-color: #fff; color: #333; font-size: 13px; }
                .invoice-box { max-width: 800px; margin: auto; padding: 20px; } .invoice-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
                .shop-details { text-align: right; } .shop-details h2 { margin: 0; color: #3498db; font-family: 'Poppins', sans-serif; } .shop-details p { margin: 2px 0; font-size: 12px; }
                .shop-logo { max-width: 150px; max-height: 150px; object-fit: contain; }
                .customer-details-wrapper { display: flex; justify-content: space-between; margin-bottom: 30px; background-color: #f8f9fa; padding: 15px; border-radius: 5px;}
                .customer-details-wrapper p { margin: 3px 0; } .invoice-title { text-align: center; margin-bottom: 20px; } .invoice-title h1 { display: inline-block; padding: 5px 20px; border: 2px solid #333; text-transform: uppercase; letter-spacing: 2px; }
                .invoice-table { width: 100%; text-align: left; border-collapse: collapse; } .invoice-table th, .invoice-table td { padding: 10px; border-bottom: 1px solid #eee; }
                .invoice-table thead th { background-color: #34495e; color: #fff; font-weight: 500; text-transform: uppercase; font-size: 12px;}
                .summary { display: flex; justify-content: flex-end; margin-top: 20px; } .summary-table { width: 45%; }
                .summary-table td { padding: 8px 10px; } .summary-table tr td:last-child { text-align: right; } .summary-table tr.total-due td { border-top: 2px solid #333; font-size: 1.1em; font-weight: bold; }
                .invoice-footer { text-align: center; margin-top: 40px; font-size: 12px; color: #777; } .signature-area { margin-top: 70px; display: flex; justify-content: space-between; }
                .signature-box { border-top: 1px solid #555; width: 220px; text-align: center; padding-top: 8px; font-weight: 500; }
                @media print { body { -webkit-print-color-adjust: exact; } .invoice-box { box-shadow: none; border: none; margin: 0; padding: 0; } }
            </style></head><body>
                <div class="invoice-box print-area">
                    <div class="invoice-header"><div><img src="${db.shopInfo.logo || ''}" alt="Logo" class="shop-logo" style="${!db.shopInfo.logo ? 'display:none;' : ''}"></div><div class="shop-details"><h2>${db.shopInfo.name}</h2><p>${db.shopInfo.address || ''}</p><p>Mobile: ${db.shopInfo.mobile || ''}</p><p>${db.shopInfo.proprietor || ''}</p></div></div>
                    <div class="invoice-title"><h1>Invoice</h1></div>
                    <div class="customer-details-wrapper"><div><p><strong>Billed To:</strong></p><p style="font-size: 1.1em; font-weight: 600;">${customer}</p></div><div style="text-align: right;"><p><strong>Invoice No:</strong> ${invoiceId.slice(-6)}</p><p><strong>Date:</strong> ${displayDate}</p></div></div>
                    <table class="invoice-table"><thead><tr><th>SL</th><th>Item Description</th><th>Unit Price</th><th>Quantity</th><th>Total</th></tr></thead><tbody>${itemsHtml}</tbody></table>
                    <div class="summary"><table class="summary-table"><tbody><tr><td>Subtotal:</td><td>${total.toFixed(2)}</td></tr><tr><td>Previous Due:</td><td>${previousDue.toFixed(2)}</td></tr><tr style="font-weight: 600;"><td>Grand Total:</td><td>${grandTotal.toFixed(2)}</td></tr><tr><td>Discount:</td><td>- ${discount.toFixed(2)}</td></tr><tr><td>Paid Amount:</td><td>- ${paid.toFixed(2)}</td></tr><tr class="total-due"><td>Total Due:</td><td>${finalDue.toFixed(2)}</td></tr></tbody></table></div>
                    <div class="signature-area"><div class="signature-box">Customer's Signature</div><div class="signature-box">Authorized Signature</div></div>
                    <div class="invoice-footer"><p>Thank you for your business!</p></div>
                </div></body></html>`;
        }
        function printInvoice(htmlContent) {
            const printWindow = window.open('', '_blank'); printWindow.document.write(htmlContent); printWindow.document.close(); printWindow.focus();
            setTimeout(() => { printWindow.print(); printWindow.close(); }, 250);
        }
        window.reprintInvoice = (invoiceId) => { 
            const masterSale = db.sales.find(s => s.invoiceId === invoiceId && s.isPaymentRecord); 
            if (!masterSale) { alert('Invoice not found!'); return; } 
            const saleItems = db.sales.filter(s => s.invoiceId === invoiceId && !s.isPaymentRecord); 
            const html = generateInvoiceHtml(masterSale.customer, masterSale.invoiceId, masterSale.total, masterSale.discount, masterSale.paid, masterSale.due, saleItems, new Date(masterSale.timestamp).toLocaleDateString('en-GB'));
            printInvoice(html);
        };
        
        function loadDashboardData(period = 'today') {
            const now = new Date(); let startDate, endDate;
            const todayDate = new Date(); const todayStr = todayDate.toISOString().split('T')[0]; endDate = todayStr;
            if (period === 'today') { startDate = todayStr; } else if (period === 'weekly') { const firstDayOfWeek = new Date(todayDate.setDate(todayDate.getDate() - todayDate.getDay())); startDate = firstDayOfWeek.toISOString().split('T')[0]; } else if (period === 'monthly') { const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1); startDate = firstDayOfMonth.toISOString().split('T')[0]; } else if (period === 'yearly') { const firstDayOfYear = new Date(now.getFullYear(), 0, 1); startDate = firstDayOfYear.toISOString().split('T')[0]; } else { startDate = '1970-01-01'; endDate = '2999-12-31'; }
            const filterByDate = item => item.date && item.date >= startDate && item.date <= endDate;
            const paymentRecordsInRange = db.sales.filter(filterByDate).filter(s => s.isPaymentRecord);
            const totalRevenueInRange = paymentRecordsInRange.reduce((sum, s) => sum + s.paid, 0);
            const invoiceIdsInRange = paymentRecordsInRange.map(p => p.invoiceId);
            const itemSalesInRange = db.sales.filter(s => invoiceIdsInRange.includes(s.invoiceId) && !s.isPaymentRecord);
            const totalCostOfGoodsSoldInRange = itemSalesInRange.reduce((costSum, sale) => { const product = db.products.find(p => p.name === sale.product); if (product) { return costSum + ((product.purchaseCost || 0) * sale.quantity); } return costSum; }, 0);
            const totalPurchasesInRange = db.purchases.filter(filterByDate).reduce((sum, p) => sum + p.total, 0);
            const totalShopExpenseInRange = db.shopExpenses.filter(filterByDate).reduce((sum, e) => sum + e.amount, 0);
            const totalComputerIncomeInRange = db.computerIncomes.filter(filterByDate).reduce((sum, i) => sum + i.amount, 0);
            const totalDueOverall = db.sales.filter(s => s.isPaymentRecord).reduce((sum, s) => sum + s.due, 0);
            const mobileFinanceBalance = db.mobileFinances.reduce((balance, item) => { return item.type === 'Cash In' ? balance + item.amount : balance - item.amount; }, 0);
            const titles = { sale: { bn: "‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø", en: "Sale" }, purchase: { bn: "‡¶ï‡ßç‡¶∞‡ßü", en: "Purchase" }, profit: { bn: "‡¶≤‡¶æ‡¶≠", en: "Profit" }, expense: { bn: "‡¶ñ‡¶∞‡¶ö", en: "Expense" }, computerIncome: { bn: "‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ", en: "Computer Income" } };
            const periodPrefix = { today: { bn: '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞', en: "Today's" }, weekly: { bn: '‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï', en: "Weekly" }, monthly: { bn: '‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï', en: "Monthly" }, yearly: { bn: '‡¶¨‡¶æ‡ßé‡¶∏‡¶∞‡¶ø‡¶ï', en: "Yearly" }, all: { bn: '‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü', en: 'Total' } };
            const prefix = periodPrefix[period][currentLanguage];
            document.querySelector('.card.c1 h3').textContent = `${prefix} ${titles.sale[currentLanguage]}`; document.querySelector('.card.c2 h3').textContent = `${prefix} ${titles.purchase[currentLanguage]}`; document.querySelector('.card.c3 h3').textContent = `${prefix} ${titles.profit[currentLanguage]}`; document.querySelector('.card.c7 h3').textContent = `${prefix} ${titles.expense[currentLanguage]}`; document.querySelector('.card.c8 h3').textContent = `${prefix} ${titles.computerIncome[currentLanguage]}`;
            document.querySelector('.card.c6 h3').textContent = translations.dashTotalDue[currentLanguage]; document.querySelector('.card.c9 h3').textContent = translations.dashMobileFinanceBalance[currentLanguage]; document.querySelector('.card.c4 h3').textContent = translations.dashTotalCustomers[currentLanguage]; document.querySelector('.card.c5 h3').textContent = translations.dashTotalSuppliers[currentLanguage];
            document.getElementById('today-sale').textContent = totalRevenueInRange.toFixed(2); document.getElementById('today-purchase').textContent = totalPurchasesInRange.toFixed(2); document.getElementById('today-profit').textContent = (totalRevenueInRange - totalCostOfGoodsSoldInRange).toFixed(2); document.getElementById('monthly-shop-expense').textContent = totalShopExpenseInRange.toFixed(2); document.getElementById('total-computer-income').textContent = totalComputerIncomeInRange.toFixed(2); 
            document.getElementById('total-due-from-customers').textContent = totalDueOverall.toFixed(2); document.getElementById('mobile-finance-balance').textContent = mobileFinanceBalance.toFixed(2); document.getElementById('total-customers').textContent = db.customers.length; document.getElementById('total-suppliers').textContent = db.suppliers.length; 
        }

        function handleReportGeneration(e) {
            e.preventDefault();
            const start = document.getElementById('report-start-date').value;
            const end = document.getElementById('report-end-date').value;
            if (!start || !end) {
                alert("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßá‡¶∑‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¶‡¶ø‡¶®‡•§");
                return;
            }

            const filterByDate = item => item.date >= start && item.date <= end;
            
            const paymentRecordsInRange = db.sales.filter(filterByDate).filter(s => s.isPaymentRecord);
            const totalSales = paymentRecordsInRange.reduce((s, i) => s + i.total, 0);
            const totalDiscount = paymentRecordsInRange.reduce((s, i) => s + (i.discount || 0), 0);
            const invoiceIdsInRange = paymentRecordsInRange.map(p => p.invoiceId);
            const itemSalesInRange = db.sales.filter(s => invoiceIdsInRange.includes(s.invoiceId) && !s.isPaymentRecord);
            const totalCost = itemSalesInRange.reduce((costSum, sale) => {
                const product = db.products.find(p => p.name === sale.product);
                if (product) { return costSum + ((product.purchaseCost || 0) * sale.quantity); }
                return costSum;
            }, 0);

            const totalCompIncome = db.computerIncomes.filter(filterByDate).reduce((s, i) => s + i.amount, 0);
            const totalShopExp = db.shopExpenses.filter(filterByDate).reduce((s, i) => s + i.amount, 0);
            const totalIncome = totalSales + totalCompIncome;
            const totalExpense = totalCost + totalShopExp + totalDiscount;
            const netProfit = totalIncome - totalExpense;

            document.getElementById('report-output').innerHTML = `<div class="print-area"><h3>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü (${start} ‡¶•‡ßá‡¶ï‡ßá ${end})</h3><ul><li>‡¶™‡¶£‡ßç‡¶Ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡ßü: ${totalSales.toFixed(2)}</li><li>‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡ßü: ${totalCompIncome.toFixed(2)}</li><li><b>‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü: ${totalIncome.toFixed(2)}</b></li><hr><li>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶§ ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ñ‡¶∞‡¶ö: ${totalCost.toFixed(2)}</li><li>‡¶™‡ßç‡¶∞‡¶¶‡¶§‡ßç‡¶§ ‡¶õ‡¶æ‡ßú: ${totalDiscount.toFixed(2)}</li><li>‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ñ‡¶∞‡¶ö: ${totalShopExp.toFixed(2)}</li><li><b>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡ßü: ${totalExpense.toFixed(2)}</b></li><hr><li><h3>‡¶®‡ßÄ‡¶ü ‡¶≤‡¶æ‡¶≠/‡¶ï‡ßç‡¶∑‡¶§‡¶ø: ${netProfit.toFixed(2)}</h3></li></ul></div>`;
            document.getElementById('print-report-btn').style.display = 'inline-block';
            document.getElementById('report-charts-container').style.display = 'block';

            if(incomeExpenseChartInstance) { incomeExpenseChartInstance.destroy(); }
            if(topProductsChartInstance) { topProductsChartInstance.destroy(); }

            const incomeExpenseCtx = document.getElementById('incomeExpenseChart').getContext('2d');
            incomeExpenseChartInstance = new Chart(incomeExpenseCtx, {
                type: 'bar',
                data: {
                    labels: ['‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü', '‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡ßü', '‡¶®‡ßÄ‡¶ü ‡¶≤‡¶æ‡¶≠'],
                    datasets: [{
                        label: '‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£',
                        data: [totalIncome, totalExpense, netProfit],
                        backgroundColor: ['rgba(46, 204, 113, 0.7)', 'rgba(231, 76, 60, 0.7)', 'rgba(52, 152, 219, 0.7)'],
                        borderColor: ['#2ecc71', '#e74c3c', '#3498db'],
                        borderWidth: 1
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });

            const productSales = {};
            itemSalesInRange.forEach(sale => {
                productSales[sale.product] = (productSales[sale.product] || 0) + sale.quantity;
            });
            const sortedProducts = Object.entries(productSales).sort(([,a],[,b]) => b-a).slice(0, 5);
            
            const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
            topProductsChartInstance = new Chart(topProductsCtx, {
                type: 'pie',
                data: {
                    labels: sortedProducts.map(p => p[0]),
                    datasets: [{
                        label: '‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶§ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£',
                        data: sortedProducts.map(p => p[1]),
                        backgroundColor: ['#3498db', '#2ecc71', '#f1c40f', '#e74c3c', '#9b59b6'],
                        hoverOffset: 4
                    }]
                }
            });
        }

        function printReport() { const reportOutput = document.getElementById('report-output'); const clone = reportOutput.cloneNode(true); const printWindow = window.open('', '_blank'); printWindow.document.write(`<html><head><title>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</title><style>body{font-family: 'Poppins', sans-serif;} h3,li{margin-bottom:10px;} hr{margin:15px 0;}</style></head><body><h2 style="text-align:center;">${db.shopInfo.name}</h2>${clone.innerHTML}</body></html>`); printWindow.document.close(); printWindow.focus(); printWindow.print(); printWindow.close(); }
        function setAppLogo(logoSrc) { const headerLogo = document.getElementById('header-logo'); const profileLogo = document.getElementById('logo-preview'); const loginLogo = document.getElementById('login-page-logo'); const defaultLogo = 'https://via.placeholder.com/200'; if (logoSrc) { headerLogo.src = logoSrc; headerLogo.style.display = 'inline-block'; profileLogo.src = logoSrc; if(loginLogo) loginLogo.src = logoSrc; } else { headerLogo.style.display = 'none'; profileLogo.src = defaultLogo; if(loginLogo) loginLogo.src = defaultLogo; } }
        function loadProfilePage() { setAppLogo(db.shopInfo.logo); }
        function handleLogoUpload(e) { const file = e.target.files[0]; if (!file) return; const apiKey = '07a9c70579b89377dc931ef0fb35e0f4'; const formData = new FormData(); formData.append('image', file); fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, { method: 'POST', body: formData }).then(response => response.json()).then(result => { if(result.success){ database.ref('shopInfo/logo').set(result.data.url); alert('‡¶≤‡ßã‡¶ó‡ßã ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§'); } else { throw new Error(result.error.message); } }).catch(error => alert('‡¶≤‡ßã‡¶ó‡ßã ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + error.message)); }
        
        function loadSettingsPage() {
            database.ref('shopInfo').once('value', (snapshot) => { 
                const info = snapshot.val() || {}; 
                document.getElementById('shop-name').value = info.name || '‡¶∂‡¶´‡¶ø‡¶ï‡ßÅ‡¶≤ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ï‡¶∞‡ßç‡¶®‡¶æ‡¶∞'; 
                document.getElementById('shop-address').value = info.address || ''; 
                document.getElementById('shop-mobile').value = info.mobile || ''; 
                document.getElementById('shop-proprietor').value = info.proprietor || ''; 
                document.getElementById('sms-gateway-url').value = info.smsGatewayUrl || ''; 
            });
            // ‚úÖ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶≠‡ßÇ‡¶Æ‡¶ø‡¶ï‡¶æ‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶°‡ßá‡¶û‡ßç‡¶ú‡¶æ‡¶∞ ‡¶ú‡ßã‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶¨‡¶æ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
            const dangerZone = document.getElementById('danger-zone');
            if (loggedInUser && (loggedInUser.role === 'Admin' || loggedInUser.name === 'Super Admin')) {
                dangerZone.style.display = 'block';
            } else {
                dangerZone.style.display = 'none';
            }
        }

        // ‚úÖ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function handleDeleteAllData() {
            const confirmation1 = prompt('‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡¶¶‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶π‡¶®, ‡¶§‡¶¨‡ßá ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø‡¶§‡ßá "DELETE" ‡¶∂‡¶¨‡ßç‡¶¶‡¶ü‡¶ø ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            if (confirmation1 !== 'DELETE') {
                alert('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
                return;
            }

            const confirmation2 = confirm('‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶¨‡¶æ‡¶£‡ßÄ! ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó‡•§ "OK" ‡¶ö‡¶æ‡¶™‡¶≤‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§');
            if (confirmation2) {
                alert('‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...');
                database.ref().remove()
                    .then(() => {
                        alert('‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá‡•§');
                        window.location.reload();
                    })
                    .catch((error) => {
                        alert('‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + error.message);
                    });
            } else {
                alert('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
            }
        }

        function handleSettingsSubmit(e) { e.preventDefault(); const newInfo = { name: document.getElementById('shop-name').value, address: document.getElementById('shop-address').value, mobile: document.getElementById('shop-mobile').value, proprietor: document.getElementById('shop-proprietor').value, smsGatewayUrl: document.getElementById('sms-gateway-url').value.trim() }; database.ref('shopInfo').update(newInfo).then(() => alert('‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§')); }
        function handlePasswordChange(e) { e.preventDefault(); if (document.getElementById('current-password').value === db.credentials.password) { const newPassword = document.getElementById('new-password').value; database.ref('credentials/password').set(newPassword).then(() => { alert('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§'); e.target.reset(); }); } else { alert('‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤‡•§'); } }
        function loadUserManagementPage() { const tBody = document.querySelector('#user-table tbody'); tBody.innerHTML = ''; db.users.forEach((user) => { tBody.innerHTML += `<tr><td data-label="‡¶®‡¶æ‡¶Æ">${user.name}</td><td data-label="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤">${user.mobile}</td><td data-label="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">${user.email || ''}</td><td data-label="‡¶≠‡ßÇ‡¶Æ‡¶ø‡¶ï‡¶æ">${user.role}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn edit-btn" onclick="editItem('users', '${user.id}')">${translations.editBtn[currentLanguage]}</button><button class="action-btn delete-btn" onclick="deleteItem('users', '${user.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('user-form'), document.getElementById('user-submit-btn'), 'saveBtn'); document.getElementById('user-pass').placeholder = '‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°'; document.getElementById('user-pass').required = true; }
        function handleUserSubmit(e) { e.preventDefault(); const btn = document.getElementById('user-submit-btn'); btn.disabled = true; const userData = { name: document.getElementById('user-name').value.trim(), mobile: document.getElementById('user-mobile').value, email: document.getElementById('user-email').value, role: document.getElementById('user-role').value }; const pass = document.getElementById('user-pass').value; let promise; if (editState.key === 'users' && editState.id) { if (pass) userData.pass = pass; promise = database.ref('users').child(editState.id).update(userData); } else { userData.pass = pass; promise = database.ref('users').push(userData); } promise.then(() => { const action = (editState.key === 'users') ? '‡¶Ü‡¶™‡¶°‡ßá‡¶ü' : '‡¶∏‡ßá‡¶≠'; alert(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${action} ‡¶π‡ßü‡ßá‡¶õ‡ßá!`); }).catch(err => { alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message); btn.disabled = false; }); }
        function loadUnitsPage() { const tBody = document.querySelector('#unit-table tbody'); tBody.innerHTML = ''; db.units.forEach((unit) => { tBody.innerHTML += `<tr><td data-label="Unit-‡¶è‡¶∞ ‡¶®‡¶æ‡¶Æ">${unit.name}</td><td data-label="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£">${unit.description || ''}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn edit-btn" onclick="editItem('units', '${unit.id}')">${translations.editBtn[currentLanguage]}</button><button class="action-btn delete-btn" onclick="deleteItem('units', '${unit.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('unit-form'), document.getElementById('unit-submit-btn'), 'saveUnitBtn'); }
        function handleUnitSubmit(e) { e.preventDefault(); const btn = document.getElementById('unit-submit-btn'); btn.disabled = true; const unitData = { name: document.getElementById('unit-name').value.trim(), description: document.getElementById('unit-description').value }; let promise; if (editState.key === 'units' && editState.id) { promise = database.ref('units').child(editState.id).update(unitData); } else { promise = database.ref('units').push(unitData); } promise.then(() => { const action = (editState.key === 'units') ? '‡¶Ü‡¶™‡¶°‡ßá‡¶ü' : '‡¶∏‡ßá‡¶≠'; alert(`Unit ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${action} ‡¶π‡ßü‡ßá‡¶õ‡ßá!`); }).catch(err => { alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message); btn.disabled = false; }); }
        function loadCategoryPage() { const tBody = document.querySelector('#category-table tbody'); tBody.innerHTML = ''; db.categories.forEach((item) => { tBody.innerHTML += `<tr><td data-label="‡¶®‡¶æ‡¶Æ">${item.name}</td><td data-label="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£">${item.description || ''}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn edit-btn" onclick="editItem('categories', '${item.id}')">${translations.editBtn[currentLanguage]}</button><button class="action-btn delete-btn" onclick="deleteItem('categories', '${item.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('category-form'), document.getElementById('category-submit-btn'), 'saveBtn'); }
        function handleCategorySubmit(e) { e.preventDefault(); const btn = document.getElementById('category-submit-btn'); btn.disabled = true; const data = { name: document.getElementById('category-name').value.trim(), description: document.getElementById('category-description').value }; let promise; if (editState.key === 'categories' && editState.id) { promise = database.ref('categories').child(editState.id).update(data); } else { promise = database.ref('categories').push(data); } promise.then(() => { const action = (editState.key === 'categories') ? '‡¶Ü‡¶™‡¶°‡ßá‡¶ü' : '‡¶∏‡ßá‡¶≠'; alert(`‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${action} ‡¶π‡ßü‡ßá‡¶õ‡ßá!`); }).catch(err => { alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message); btn.disabled = false; }); }
        function loadBrandPage() { const tBody = document.querySelector('#brand-table tbody'); tBody.innerHTML = ''; db.brands.forEach((item) => { tBody.innerHTML += `<tr><td data-label="‡¶®‡¶æ‡¶Æ">${item.name}</td><td data-label="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£">${item.description || ''}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn edit-btn" onclick="editItem('brands', '${item.id}')">${translations.editBtn[currentLanguage]}</button><button class="action-btn delete-btn" onclick="deleteItem('brands', '${item.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('brand-form'), document.getElementById('brand-submit-btn'), 'saveBtn'); }
        function handleBrandSubmit(e) { e.preventDefault(); const btn = document.getElementById('brand-submit-btn'); btn.disabled = true; const data = { name: document.getElementById('brand-name').value.trim(), description: document.getElementById('brand-description').value }; let promise; if (editState.key === 'brands' && editState.id) { promise = database.ref('brands').child(editState.id).update(data); } else { promise = database.ref('brands').push(data); } promise.then(() => { const action = (editState.key === 'brands') ? '‡¶Ü‡¶™‡¶°‡ßá‡¶ü' : '‡¶∏‡ßá‡¶≠'; alert(`‡¶¨‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${action} ‡¶π‡ßü‡ßá‡¶õ‡ßá!`); }).catch(err => { alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message); btn.disabled = false; }); }
        function loadSmsSenderPage() { const customerSelect = document.getElementById('sms-customer-select'); customerSelect.innerHTML = '<option value="">-- ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® --</option>'; db.customers.filter(c => c.mobile).forEach(customer => { customerSelect.innerHTML += `<option value="${customer.id}">${customer.name} - ${customer.mobile}</option>`; }); document.getElementById('sms-form').reset(); }
        function handleSendWhatsApp() { const customerId = document.getElementById('sms-customer-select').value; const message = document.getElementById('sms-message-body').value.trim(); if (!customerId) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ú‡¶® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); return; } if (!message) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§'); return; } const customer = db.customers.find(c => c.id === customerId); if (!customer || !customer.mobile) { alert('‡¶è‡¶á ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§'); return; } let phoneNumber = customer.mobile.replace(/[\s+-]/g, ''); if (phoneNumber.length === 11 && phoneNumber.startsWith('01')) { phoneNumber = '88' + phoneNumber; } const encodedMessage = encodeURIComponent(message); const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`; window.open(whatsappUrl, '_blank'); }
        function loadSmsTemplatesPage() { const tBody = document.querySelector('#template-table tbody'); tBody.innerHTML = ''; db.templates.forEach(template => { tBody.innerHTML += `<tr><td data-label="‡¶®‡¶æ‡¶Æ">${template.name}</td><td data-label="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú" style="white-space: pre-wrap;">${template.body}</td><td data-label="‡¶è‡¶ï‡¶∂‡¶®"><button class="action-btn edit-btn" onclick="editItem('templates', '${template.id}')">${translations.editBtn[currentLanguage]}</button><button class="action-btn delete-btn" onclick="deleteItem('templates', '${template.id}')">${translations.deleteBtn[currentLanguage]}</button></td></tr>`; }); resetForm(document.getElementById('template-form'), document.getElementById('template-submit-btn'), 'saveBtn'); }
        function handleSmsTemplateSubmit(e) { e.preventDefault(); const btn = document.getElementById('template-submit-btn'); btn.disabled = true; const templateData = { name: document.getElementById('template-name').value.trim(), body: document.getElementById('template-body').value }; let promise; if (editState.key === 'templates' && editState.id) { promise = database.ref('templates').child(editState.id).update(templateData); } else { promise = database.ref('templates').push(templateData); } promise.then(() => { alert('‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); }).catch(err => { alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + err.message); btn.disabled = false; }); }
        async function sendDueReminderSms(customerId) { const gatewayUrl = db.shopInfo.smsGatewayUrl; if (!gatewayUrl) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶™‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá SMS ‡¶ó‡ßá‡¶ü‡¶ì‡ßü‡ßá URL ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); return; } if (db.templates.length === 0) { alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡¶ü‡¶ø SMS ‡¶ü‡ßá‡¶Æ‡¶™‡ßç‡¶≤‡ßá‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); return; } const customer = db.customers.find(c => c.id === customerId); if (!customer || !customer.mobile) { alert('‡¶è‡¶á ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§'); return; } const totalDue = db.sales.filter(s => s.isPaymentRecord && s.customer === customer.name).reduce((sum, s) => sum + s.due, 0); if (totalDue <= 0) { alert('‡¶è‡¶á ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶®‡ßá‡¶á‡•§'); return; } let messageBody = db.templates[0].body; messageBody = messageBody.replace(/{customer_name}/g, customer.name); messageBody = messageBody.replace(/{due_amount}/g, totalDue.toFixed(2)); let phoneNumber = customer.mobile.replace(/[\s+-]/g, ''); if (phoneNumber.length === 11 && phoneNumber.startsWith('01')) phoneNumber = '+88' + phoneNumber; if (confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø "${customer.name}"-‡¶ï‡ßá ‡¶è‡¶á ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶ü‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?\n\n"${messageBody}"`)) { try { const response = await fetch(`${gatewayUrl}/api/v1/sms/send`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ number: phoneNumber, message: messageBody }) }); const result = await response.json(); if (response.ok && result.success) { alert('SMS ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶®‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!'); } else { throw new Error(result.message || 'SMS ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§'); } } catch (error) { console.error('SMS ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:', error); alert(`SMS ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ \n\nError: ${error.message}`); } } }
        window.filterTable = (tableId, columnIndex) => { const inputId = tableId.replace('-table', '-search-input'); const input = document.getElementById(inputId); const filter = input.value.toUpperCase(); const table = document.getElementById(tableId); const tr = table.getElementsByTagName('tr'); for (let i = 1; i < tr.length; i++) { let td = tr[i].getElementsByTagName('td')[columnIndex]; if (td) { if (td.textContent.toUpperCase().indexOf(filter) > -1) { tr[i].style.display = ""; } else { tr[i].style.display = "none"; } } } };

        init();
    });
    </script>
</body>
</html>
